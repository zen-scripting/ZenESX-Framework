<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="page_title">ZS Banking System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>
    <div id="banking-container" class="hidden">
        <!-- Header -->
        <div class="header">
            <div class="bank-info">
                <div class="bank-details">
                    <i class="fas fa-university"></i>
                    <h1 id="bank-name">üè¶ ZS BANKING SYSTEM</h1>
                </div>
            </div>
            <button class="close-btn" onclick="closeBanking()">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="tab-btn" onclick="switchTab('overview')" data-tab="overview">
                <i class="fas fa-chart-pie"></i>
                <span data-translate="overview">üìä √úBERSICHT</span>
            </button>
            <button class="tab-btn" onclick="switchTab('deposit')" data-tab="deposit">
                <i class="fas fa-arrow-down"></i>
                <span data-translate="deposit_tab">üí∞ EINZAHLEN</span>
            </button>
            <button class="tab-btn" onclick="switchTab('withdraw')" data-tab="withdraw">
                <i class="fas fa-arrow-up"></i>
                <span data-translate="withdraw_tab">üí∏ ABHEBEN</span>
            </button>
            <button class="tab-btn" onclick="switchTab('transfer')" data-tab="transfer">
                <i class="fas fa-exchange-alt"></i>
                <span data-translate="transfer_tab">üîÑ √úBERWEISEN</span>
            </button>
            <button class="tab-btn" onclick="switchTab('transactions')" data-tab="transactions">
                <i class="fas fa-history"></i>
                <span data-translate="transactions_tab">üìú VERLAUF</span>
            </button>
            <button class="tab-btn" onclick="switchTab('crypto')" data-tab="crypto" id="crypto-tab-btn" style="display: none;">
                <i class="fas fa-bitcoin"></i>
                <span data-translate="crypto_tab">‚Çø CRYPTO</span>
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content" style="display: block;">
                <!-- Spieler-Info-Bereich -->
                <div class="player-info-section">
                    <div class="player-details">
                        <!-- Karte 1: Spieler-Informationen -->
                        <div class="player-name-card">
                            <i class="fas fa-user"></i>
                            <div class="player-info">
                                <h3 id="overview-player-name">üë§ SPIELER NAME</h3>
                                <p data-translate="player_label">SPIELER</p>
                            </div>
                        </div>
                        
                        <!-- Karte 2: Letzte Transaktion -->
                        <div class="transaction-card">
                            <i class="fas fa-clock"></i>
                            <div class="transaction-info">
                                <h4 data-translate="last_transaction">LETZTE TRANSAKTION</h4>
                                <div id="overview-last-transaction">
                                    <div style="color: #888888; font-style: italic;">Keine Transaktionen verf√ºgbar</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Karte 3: Bargeld -->
                        <div class="balance-card">
                            <i class="fas fa-wallet"></i>
                            <div class="balance-info">
                                <h4 data-translate="cash_text">BARGELD</h4>
                                <span id="overview-cash-balance">üíµ $0</span>
                            </div>
                        </div>
                        
                        <!-- Karte 4: Bankkonto -->
                        <div class="balance-card">
                            <i class="fas fa-university"></i>
                            <div class="balance-info">
                                <h4 data-translate="bank_text">BANKKONTO</h4>
                                <span id="overview-bank-balance">üè¶ $0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Schnellaktionen -->
                <div class="quick-actions">
                    <h3 data-translate="quick_actions">‚ö° SCHNELLAKTIONEN</h3>
                    <div class="action-grid">
                        <button class="quick-action-btn deposit" onclick="switchTab('deposit')">
                            <i class="fas fa-arrow-down"></i>
                            <span data-translate="deposit_tab">EINZAHLEN</span>
                        </button>
                        <button class="quick-action-btn withdraw" onclick="switchTab('withdraw')">
                            <i class="fas fa-arrow-up"></i>
                            <span data-translate="withdraw_tab">ABHEBEN</span>
                        </button>
                        <button class="quick-action-btn transfer" onclick="switchTab('transfer')">
                            <i class="fas fa-exchange-alt"></i>
                            <span data-translate="transfer_tab">√úBERWEISEN</span>
                        </button>
                        <button class="quick-action-btn crypto" onclick="switchTab('crypto')" id="crypto-quick-action" style="display: none;">
                            <i class="fas fa-bitcoin"></i>
                            <span data-translate="crypto_tab">‚Çø CRYPTO</span>
                        </button>
                    </div>
                </div>
                
                <!-- Last Transaction Info - ENTFERNT, da jetzt im Spieler-Info-Kasten -->
            </div>

            <!-- Einzahlen Tab -->
            <div id="deposit" class="tab-content" style="display: none;">
                <div class="transaction-form">
                    <h3><i class="fas fa-arrow-down"></i> <span data-translate="deposit_title">üí∞ GELD EINZAHLEN</span></h3>
                    <div class="form-image">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <div class="input-group">
                        <label for="deposit-amount" data-translate="amount">üíµ BETRAG:</label>
                        <input type="number" id="deposit-amount" data-translate-placeholder="amount_placeholder" placeholder="Betrag eingeben" min="1">
                    </div>

                    <button class="action-btn deposit-btn" onclick="deposit()">
                        <i class="fas fa-arrow-down"></i>
                        <span data-translate="deposit_btn">üí∞ EINZAHLEN</span>
                    </button>
                </div>
            </div>

            <!-- Abheben Tab -->
            <div id="withdraw" class="tab-content" style="display: none;">
                <div class="transaction-form">
                    <h3><i class="fas fa-arrow-up"></i> <span data-translate="withdraw_title">üí∏ GELD ABHEBEN</span></h3>
                    <div class="form-image">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="input-group">
                        <label for="withdraw-amount" data-translate="amount">üíµ BETRAG:</label>
                        <input type="number" id="withdraw-amount" data-translate-placeholder="amount_placeholder" placeholder="Betrag eingeben" min="1">
                    </div>

                    <button class="action-btn withdraw-btn" onclick="withdraw()">
                        <i class="fas fa-arrow-up"></i>
                        <span data-translate="withdraw_btn">üí∏ ABHEBEN</span>
                    </button>
                </div>
            </div>

            <!-- Transfer Tab -->
            <div id="transfer" class="tab-content" style="display: none;">
                <div class="transaction-form">
                    <h3><i class="fas fa-exchange-alt"></i> <span data-translate="transfer_title">üîÑ Geld √ºberweisen</span></h3>
                    <div class="form-image">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="input-group">
                        <label for="transfer-player" data-translate="player_id">üë§ Spieler ID:</label>
                        <input type="number" id="transfer-player" data-translate-placeholder="player_id_placeholder" placeholder="Spieler ID eingeben" min="1">
                    </div>
                    <div class="input-group">
                        <label for="transfer-amount" data-translate="amount">üíµ Betrag:</label>
                        <input type="number" id="transfer-amount" data-translate-placeholder="amount_placeholder" placeholder="Betrag eingeben" min="1">
                    </div>

                    <button class="action-btn transfer-btn" onclick="transfer()">
                        <i class="fas fa-exchange-alt"></i>
                        <span data-translate="transfer_btn">üîÑ √úberweisen</span>
                    </button>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactions" class="tab-content" style="display: none;">
                <h3><i class="fas fa-history"></i> <span data-translate="transactions_title">üìú Transaktionsverlauf</span></h3>
                <div id="transactions-list" class="transactions-list">
                    <div class="no-transactions" id="no-transactions">
                        <i class="fas fa-inbox"></i>
                        <p data-translate="no_transactions_text">üìù Keine Transaktionen vorhanden</p>
                    </div>
                </div>
            </div>

            <!-- Crypto Tab -->
            <div id="crypto" class="tab-content" style="display: none;">
                <!-- Crypto Header -->
                <div class="crypto-header">
                    <div class="crypto-title-section">
                        <h2><i class="fab fa-bitcoin"></i> <span data-translate="crypto_title">‚Çø CRYPTO VERWALTUNG</span></h2>
                        <p class="crypto-subtitle">Professionelles Kryptow√§hrung-Management</p>
                    </div>
                    <div class="crypto-status-indicators">
                        <div class="status-indicator online">
                            <i class="fas fa-circle"></i>
                            <span>Live Market</span>
                        </div>
                        <div class="market-time">
                            <i class="far fa-clock"></i>
                            <span id="market-time">24/7 Trading</span>
                        </div>
                    </div>
                </div>

                <!-- Crypto Navigation Tabs -->
                <div class="crypto-nav-tabs">
                    <button class="crypto-nav-btn active" onclick="showCryptoSection('overview')">
                        <i class="fas fa-tachometer-alt"></i>
                        <span data-translate="overview">Dashboard</span>
                    </button>
                    <button class="crypto-nav-btn" onclick="showCryptoSection('trading')">
                        <i class="fas fa-exchange-alt"></i>
                        <span data-translate="trading">Trading</span>
                    </button>
                    <button class="crypto-nav-btn" onclick="showCryptoSection('charts')">
                        <i class="fas fa-chart-line"></i>
                        <span data-translate="charts">Charts</span>
                    </button>
                    <button class="crypto-nav-btn" onclick="showCryptoSection('portfolio')">
                        <i class="fas fa-briefcase"></i>
                        <span data-translate="portfolio">Portfolio</span>
                    </button>
                    <button class="crypto-nav-btn" onclick="showCryptoSection('staking')">
                        <i class="fas fa-coins"></i>
                        <span data-translate="staking">Staking</span>
                    </button>
                    <button class="crypto-nav-btn" onclick="showCryptoSection('contests')">
                        <i class="fas fa-trophy"></i>
                        <span data-translate="contests">Contests</span>
                    </button>
                    <button class="crypto-nav-btn" onclick="showCryptoSection('insights')">
                        <i class="fas fa-brain"></i>
                        <span data-translate="insights">Insights</span>
                    </button>
                </div>

                <!-- Dashboard Section -->
                <div id="crypto-overview" class="crypto-section active">
                    <!-- Portfolio Summary Cards -->
                    <div class="portfolio-summary">
                        <div class="summary-card portfolio-value">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <div class="card-title">
                                    <h4 data-translate="portfolio_value">Portfolio Wert</h4>
                                    <span class="card-subtitle">Gesamt</span>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="main-value" id="crypto-portfolio-value">$0.00</div>
                                <div class="change-indicator" id="portfolio-change">
                                    <span class="change-value">+$0.00</span>
                                    <span class="change-percent">(+0.00%)</span>
                                </div>
                            </div>
                        </div>

                        <div class="summary-card daily-pnl">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <div class="card-title">
                                    <h4>24h P&L</h4>
                                    <span class="card-subtitle">Gewinn/Verlust</span>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="main-value" id="crypto-profit-loss">$0.00</div>
                                <div class="change-indicator" id="crypto-portfolio-change">
                                    <span class="change-percent">0.00%</span>
                                </div>
                            </div>
                        </div>

                        <div class="summary-card total-trades">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-exchange-alt"></i>
                                </div>
                                <div class="card-title">
                                    <h4>Trades Heute</h4>
                                    <span class="card-subtitle">Aktivit√§t</span>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="main-value" id="total-trades">0</div>
                                <div class="trade-volume">Volumen: $<span id="todays-volume">0.00</span></div>
                            </div>
                        </div>

                        <div class="summary-card available-cash">
                            <div class="card-header">
                                <div class="card-icon">
                                    <i class="fas fa-dollar-sign"></i>
                                </div>
                                <div class="card-title">
                                    <h4>Verf√ºgbar</h4>
                                    <span class="card-subtitle">Zum Trading</span>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="main-value" id="available-cash">$0.00</div>
                                <div class="cash-detail">Bankguthaben</div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Overview -->
                    <div class="market-overview-section">
                        <div class="section-header">
                            <h3><i class="fas fa-globe"></i> Markt√ºbersicht</h3>
                            <div class="header-actions">
                                <div class="refresh-btn" onclick="refreshMarketData()">
                                    <i class="fas fa-sync-alt"></i>
                                    <span>Aktualisieren</span>
                                </div>
                                <div class="market-status">
                                    <div class="status-dot online"></div>
                                    <span>Live</span>
                                </div>
                            </div>
                        </div>
                        <div class="crypto-market-grid" id="crypto-market-grid">
                            <!-- Market cards will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions-section">
                        <div class="section-header">
                            <h3><i class="fas fa-bolt"></i> Schnellaktionen</h3>
                        </div>
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn buy-action" onclick="quickAction('buy')">
                                <div class="action-icon">
                                    <i class="fas fa-arrow-up"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Sofort Kaufen</span>
                                    <span class="action-subtitle">Market Order</span>
                                </div>
                            </button>
                            
                            <button class="quick-action-btn sell-action" onclick="quickAction('sell')">
                                <div class="action-icon">
                                    <i class="fas fa-arrow-down"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Sofort Verkaufen</span>
                                    <span class="action-subtitle">Market Order</span>
                                </div>
                            </button>
                            
                            <button class="quick-action-btn portfolio-action" onclick="showCryptoSection('portfolio')">
                                <div class="action-icon">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Portfolio</span>
                                    <span class="action-subtitle">Analyse</span>
                                </div>
                            </button>
                            
                            <button class="quick-action-btn charts-action" onclick="showCryptoSection('charts')">
                                <div class="action-icon">
                                    <i class="fas fa-chart-bar"></i>
                                </div>
                                <div class="action-content">
                                    <span class="action-title">Charts</span>
                                    <span class="action-subtitle">Technische Analyse</span>
                                </div>
                            </button>
                        </div>
                    </div>

                    <!-- Performance Stats -->
                    <div class="performance-stats-section">
                        <div class="section-header">
                            <h3><i class="fas fa-chart-area"></i> Performance</h3>
                        </div>
                        <div class="performance-stats-grid">
                            <div class="performance-stat">
                                <div class="stat-icon">
                                    <i class="fas fa-coins"></i>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">Investiert</span>
                                    <span class="stat-value" id="total-invested">$0.00</span>
                                </div>
                            </div>
                            
                            <div class="performance-stat">
                                <div class="stat-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">Top Performer</span>
                                    <span class="stat-value" id="best-performer">-</span>
                                </div>
                            </div>
                            
                            <div class="performance-stat">
                                <div class="stat-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">ROI Gesamt</span>
                                    <span class="stat-value" id="total-roi">0.00%</span>
                                </div>
                            </div>
                            
                            <div class="performance-stat">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="stat-content">
                                    <span class="stat-label">Letzter Trade</span>
                                    <span class="stat-value" id="last-trade">Nie</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trading Section -->
                <div id="crypto-trading" class="crypto-section">
                    <!-- Currency Selection -->
                    <div class="crypto-currency-selection">
                        <h4><i class="fas fa-coins"></i> <span data-translate="crypto_select_currency">KRYPTOW√ÑHRUNG W√ÑHLEN</span></h4>
                        <select id="crypto-currency-select" onchange="updateCryptoSelection()">
                            <option value="BTC">‚Çø Bitcoin (BTC)</option>
                            <option value="ETH">‚ü† Ethereum (ETH)</option>
                            <option value="ADA">‚Ç≥ Cardano (ADA)</option>
                            <option value="XRP">‚óâ Ripple (XRP)</option>
                            <option value="DOT">‚óè Polkadot (DOT)</option>
                        </select>
                        
                        <div class="crypto-currency-info">
                            <div class="crypto-price-display">
                                <span data-translate="crypto_current_price">Aktueller Preis:</span>
                                <span id="selected-crypto-price">$0.00</span>
                                <div id="selected-crypto-change" class="price-change">0.00%</div>
                            </div>
                            <div class="crypto-holdings-display">
                                <span data-translate="crypto_your_holdings">Ihre Best√§nde:</span>
                                <span id="selected-crypto-holdings">0.0000</span>
                                <div id="selected-crypto-value">$0.00</div>
                            </div>
                        </div>
                    </div>

                    <!-- Crypto Actions -->
                    <div class="crypto-actions">
                        <div class="crypto-action-form">
                            <h4><i class="fas fa-arrow-down"></i> <span data-translate="crypto_buy">CRYPTO KAUFEN</span></h4>
                            <div class="input-group">
                                <label for="crypto-buy-amount" data-translate="crypto_amount">üíµ BETRAG IN USD:</label>
                                <input type="number" id="crypto-buy-amount" placeholder="USD Betrag eingeben" min="10">
                            </div>
                            <div class="crypto-buy-info">
                                <span data-translate="crypto_fee">Geb√ºhr:</span> <span id="crypto-buy-fee">0.00%</span>
                                <span data-translate="crypto_total">Gesamt:</span> <span id="crypto-buy-total">$0.00</span>
                                <div>Sie erhalten: <span id="crypto-buy-receive">0.0000</span></div>
                            </div>
                            <button class="action-btn crypto-buy-btn" onclick="buyCrypto()">
                                <i class="fas fa-arrow-down"></i>
                                <span data-translate="crypto_buy_btn">üí∞ KAUFEN</span>
                            </button>
                        </div>

                        <div class="crypto-action-form">
                            <h4><i class="fas fa-arrow-up"></i> <span data-translate="crypto_sell">CRYPTO VERKAUFEN</span></h4>
                            <div class="input-group">
                                <label for="crypto-sell-amount" data-translate="crypto_amount_crypto">üíé CRYPTO BETRAG:</label>
                                <input type="number" id="crypto-sell-amount" placeholder="Crypto Betrag eingeben" min="0.00000001" step="0.00000001">
                            </div>
                            <div class="crypto-sell-info">
                                <span data-translate="crypto_value">Wert:</span> <span id="crypto-sell-value">$0.00</span>
                                <span data-translate="crypto_fee">Geb√ºhr:</span> <span id="crypto-sell-fee">0.00%</span>
                                <div>Sie erhalten: <span id="crypto-sell-receive">$0.00</span></div>
                            </div>
                            <button class="action-btn crypto-sell-btn" onclick="sellCrypto()">
                                <i class="fas fa-arrow-up"></i>
                                <span data-translate="crypto_sell_btn">üíµ VERKAUFEN</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="crypto-order-management">
                        <h4><i class="fas fa-list"></i> ORDER-MANAGEMENT</h4>
                        <div class="order-types">
                            <button onclick="setOrderType('market')" class="order-type-btn active">Market Order</button>
                            <button onclick="setOrderType('limit')" class="order-type-btn">Limit Order</button>
                            <button onclick="setOrderType('stop')" class="order-type-btn">Stop Loss</button>
                        </div>
                        <div id="order-form">
                            <!-- Wird je nach Order-Typ gef√ºllt -->
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div id="crypto-charts" class="crypto-section">
                    <div class="chart-controls">
                        <select id="chart-currency">
                            <option value="BTC">Bitcoin (BTC)</option>
                            <option value="ETH">Ethereum (ETH)</option>
                            <option value="ADA">Cardano (ADA)</option>
                            <option value="XRP">Ripple (XRP)</option>
                            <option value="DOT">Polkadot (DOT)</option>
                        </select>
                        <select id="chart-timeframe">
                            <option value="1m">1 Minute</option>
                            <option value="5m">5 Minuten</option>
                            <option value="15m">15 Minuten</option>
                            <option value="1h">1 Stunde</option>
                            <option value="4h">4 Stunden</option>
                            <option value="1d" selected>1 Tag</option>
                            <option value="1w">1 Woche</option>
                        </select>
                        <select id="chart-type">
                            <option value="line">Linie</option>
                            <option value="candlestick">Kerzen</option>
                            <option value="area">Fl√§che</option>
                            <option value="bar">Balken</option>
                        </select>
                    </div>
                    <div id="crypto-chart-container">
                        <canvas id="crypto-chart" width="800" height="400"></canvas>
                    </div>
                    <div class="technical-indicators">
                        <h5>Technische Indikatoren</h5>
                        <div id="indicators-container">
                            <div class="indicator">
                                <span>RSI (14):</span>
                                <span id="rsi-value">-</span>
                            </div>
                            <div class="indicator">
                                <span>MACD:</span>
                                <span id="macd-value">-</span>
                            </div>
                            <div class="indicator">
                                <span>MA (20):</span>
                                <span id="ma-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Section -->
                <div id="crypto-portfolio" class="crypto-section">
                    <div class="portfolio-allocation">
                        <h4>Portfolio-Allokation</h4>
                        <div id="portfolio-pie-chart"></div>
                    </div>
                    <div class="portfolio-performance">
                        <h4>Performance-Metriken</h4>
                        <div class="performance-grid">
                            <div class="metric">
                                <span>Sharpe Ratio:</span>
                                <span id="sharpe-ratio">-</span>
                            </div>
                            <div class="metric">
                                <span>Max Drawdown:</span>
                                <span id="max-drawdown">-</span>
                            </div>
                            <div class="metric">
                                <span>Volatilit√§t:</span>
                                <span id="volatility">-</span>
                            </div>
                            <div class="metric">
                                <span>Beta:</span>
                                <span id="beta">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="portfolio-holdings">
                        <h4>Best√§nde</h4>
                        <div id="holdings-table">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                </div>

                <!-- Staking Section -->
                <div id="crypto-staking" class="crypto-section">
                    <div class="staking-overview">
                        <h4>Staking-√úbersicht</h4>
                        <div class="staking-stats">
                            <div class="stat">
                                <h5>Gesamt gestaked</h5>
                                <div id="total-staked">$0.00</div>
                            </div>
                            <div class="stat">
                                <h5>Gesamte Belohnungen</h5>
                                <div id="total-rewards">$0.00</div>
                            </div>
                            <div class="stat">
                                <h5>APY</h5>
                                <div id="average-apy">0.00%</div>
                            </div>
                        </div>
                    </div>
                    <div class="staking-pools">
                        <h4>Verf√ºgbare Staking-Pools</h4>
                        <div id="staking-pools-list">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                    <div class="my-staking">
                        <h4>Meine Staking-Positionen</h4>
                        <div id="my-staking-positions">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                </div>

                <!-- Contests Section -->
                <div id="crypto-contests" class="crypto-section">
                    <div class="active-contests">
                        <div class="contests-header">
                            <h4>Aktive Wettbewerbe</h4>
                            <div class="admin-controls" id="contest-admin-controls" style="display: none;">
                                <button class="btn btn-primary btn-sm" onclick="showCreateContestModal()">
                                    <i class="fas fa-plus"></i> Neuer Wettbewerb
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="refreshContests()">
                                    <i class="fas fa-refresh"></i> Aktualisieren
                                </button>
                            </div>
                        </div>
                        <div id="active-contests-list">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                    <div class="contest-leaderboard">
                        <h4>Bestenliste</h4>
                        <div id="contest-leaderboard">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                    <div class="my-contest-stats">
                        <h4>Meine Statistiken</h4>
                        <div class="contest-stats">
                            <div class="stat">
                                <h5>Teilgenommene Contests</h5>
                                <div id="contests-participated">0</div>
                            </div>
                            <div class="stat">
                                <h5>Gewonnene Preise</h5>
                                <div id="prizes-won">$0.00</div>
                            </div>
                            <div class="stat">
                                <h5>Beste Platzierung</h5>
                                <div id="best-rank">-</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Insights Section -->
                <div id="crypto-insights" class="crypto-section">
                    <div class="market-insights">
                        <h4>Markt-Einblicke</h4>
                        <div id="market-insights-list">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                    <div class="price-predictions">
                        <h4>Preisvorhersagen</h4>
                        <div id="price-predictions">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                    <div class="price-alerts">
                        <h4>Preisalarme</h4>
                        <div class="alert-creation">
                            <select id="alert-currency">
                                <option value="BTC">Bitcoin (BTC)</option>
                                <option value="ETH">Ethereum (ETH)</option>
                                <option value="ADA">Cardano (ADA)</option>
                                <option value="XRP">Ripple (XRP)</option>
                                <option value="DOT">Polkadot (DOT)</option>
                            </select>
                            <select id="alert-type">
                                <option value="above">√úber</option>
                                <option value="below">Unter</option>
                                <option value="change">√Ñnderung %</option>
                            </select>
                            <input type="number" id="alert-value" placeholder="Zielwert" step="0.01">
                            <button onclick="createPriceAlert()">Alarm erstellen</button>
                        </div>
                        <div id="active-alerts">
                            <!-- Wird dynamisch gef√ºllt -->
                        </div>
                    </div>
                </div>
                
                <!-- Crypto History - Nur am Anfang sichtbar -->
                <div class="crypto-history" id="crypto-history-section">
                    <h4><i class="fas fa-history"></i> <span data-translate="crypto_history">CRYPTO VERLAUF</span></h4>
                    <div class="history-filters">
                        <select id="history-filter">
                            <option value="all">Alle</option>
                            <option value="buy">K√§ufe</option>
                            <option value="sell">Verk√§ufe</option>
                            <option value="staking">Staking</option>
                        </select>
                        <select id="history-currency">
                            <option value="all">Alle W√§hrungen</option>
                            <option value="BTC">Bitcoin (BTC)</option>
                            <option value="ETH">Ethereum (ETH)</option>
                            <option value="ADA">Cardano (ADA)</option>
                            <option value="XRP">Ripple (XRP)</option>
                            <option value="DOT">Polkadot (DOT)</option>
                        </select>
                    </div>
                    <div id="crypto-transactions-list" class="crypto-transactions-list">
                        <div class="no-crypto-transactions" id="no-crypto-transactions">
                            <i class="fas fa-inbox"></i>
                            <p data-translate="no_crypto_transactions_text">üìù Keine Crypto-Transaktionen vorhanden</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contest Creation Modal -->
    <div id="createContestModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üèÜ Neuen Wettbewerb erstellen</h3>
                <span class="close" onclick="closeCreateContestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="createContestForm">
                    <div class="form-group">
                        <label for="contestType">Wettbewerb-Typ:</label>
                        <select id="contestType" required>
                            <option value="Trading Challenge">Trading Challenge</option>
                            <option value="Daily Trading Challenge">Daily Trading Challenge</option>
                            <option value="Crypto Speed Trading">Crypto Speed Trading</option>
                            <option value="Portfolio Growth Contest">Portfolio Growth Contest</option>
                            <option value="Risk Management Challenge">Risk Management Challenge</option>
                            <option value="High Frequency Trading">High Frequency Trading</option>
                            <option value="Custom">Benutzerdefiniert</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="customTypeGroup" style="display: none;">
                        <label for="customType">Benutzerdefinierter Typ:</label>
                        <input type="text" id="customType" placeholder="Name des Wettbewerbs">
                    </div>
                    
                    <div class="form-group">
                        <label for="contestDuration">Dauer (Minuten):</label>
                        <input type="number" id="contestDuration" min="30" max="720" value="60" required>
                        <small>Minimum: 30 Minuten, Maximum: 12 Stunden</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="contestPrizePool">Preispool ($):</label>
                        <input type="number" id="contestPrizePool" min="1000" max="100000" value="10000" required>
                        <small>Minimum: $1,000, Maximum: $100,000</small>
                    </div>
                    
                    <div class="prize-distribution">
                        <h4>Preisverteilung:</h4>
                        <ul>
                            <li>ü•á 1. Platz: 50% des Preispools</li>
                            <li>ü•à 2. Platz: 30% des Preispools</li>
                            <li>ü•â 3. Platz: 20% des Preispools</li>
                        </ul>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeCreateContestModal()">Abbrechen</button>
                <button type="button" class="btn btn-primary" onclick="createContest()">Wettbewerb erstellen</button>
            </div>
        </div>
    </div>

    <script>
        // √úbersetzungsfunktionen
        let Locales = {};
        let currentLanguage = 'de';
        
        function getTranslation(key) {
            if (window.Locales && window.Locales[currentLanguage] && window.Locales[currentLanguage][key]) {
                return window.Locales[currentLanguage][key];
            }
            // Fallback auf Deutsch
            if (window.Locales && window.Locales['de'] && window.Locales['de'][key]) {
                return window.Locales['de'][key];
            }
            return key;
        }
        
        function updateUILanguage() {
            console.log('=== updateUILanguage aufgerufen ===');
            console.log('Locales:', window.Locales);
            console.log('currentLanguage:', currentLanguage);
            
            if (!window.Locales) {
                console.error('Locales ist nicht definiert!');
                console.log('Versuche Fallback-Locales zu laden...');
                
                // Fallback: Warte kurz und versuche es erneut
                setTimeout(() => {
                    if (window.Locales) {
                        console.log('‚úÖ Locales nach Verz√∂gerung geladen');
                        updateUILanguage();
                    } else {
                        console.error('‚ùå Locales konnten nicht geladen werden');
                    }
                }, 1000);
                return;
            }
            
            if (!window.Locales[currentLanguage]) {
                console.error('Sprache nicht verf√ºgbar:', currentLanguage);
                console.log('Verf√ºgbare Sprachen:', window.Locales ? Object.keys(window.Locales) : 'Keine');
                
                // Fallback auf Deutsch
                if (window.Locales['de']) {
                    console.log('üîÑ Fallback auf Deutsch');
                    currentLanguage = 'de';
                } else {
                    console.error('‚ùå Keine Fallback-Sprache verf√ºgbar');
                    return;
                }
            }
            
            const locale = window.Locales[currentLanguage];
            console.log('Aktuelle Locale:', locale);
            
            let translatedCount = 0;
            
            // Alle Elemente mit data-translate Attribut √ºbersetzen
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (locale[key]) {
                    // Nicht √ºbersetzen wenn es sich um dynamische Daten handelt
                    if (!element.id || (!element.id.includes('player-name') && !element.id.includes('cash-balance') && !element.id.includes('bank-balance'))) {
                        element.textContent = locale[key];
                        translatedCount++;
                        console.log('√úbersetzt:', key, '->', locale[key]);
                    } else {
                        console.log('√úberspringe dynamisches Element:', element.id);
                    }
                } else {
                    console.warn('√úbersetzung nicht gefunden f√ºr:', key);
                }
            });
            
            // Placeholder √ºbersetzen
            document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (locale[key]) {
                    element.placeholder = locale[key];
                    translatedCount++;
                    console.log('Placeholder √ºbersetzt:', key, '->', locale[key]);
                } else {
                    console.warn('Placeholder-√úbersetzung nicht gefunden f√ºr:', key);
                }
            });
            
            console.log('Insgesamt √ºbersetzt:', translatedCount, 'Elemente');
        }
        
        // Event Listener f√ºr NUI-Nachrichten
        window.addEventListener('message', function(event) {
            const data = event.data;
            
            // Banking UI √∂ffnen
            if (data.action === 'openBanking') {
                console.log('=== Banking UI √∂ffnen ===');
                console.log('Empfangene Daten:', data);
                

                // Crypto-Addon Verf√ºgbarkeit pr√ºfen (zs_cryptoaddon Integration)
                let cryptoEnabled = false;
                
                // STRENGE Pr√ºfung: Config=true UND Addon verf√ºgbar
                console.log('üîç Pr√ºfe Crypto-Addon Verf√ºgbarkeit:', data.cryptoAddonAvailable);
                console.log('üîç Config-Daten:', data.config?.AddonIntegration);
                
                // Pr√ºfe BEIDE Bedingungen:
                // 1. Config explizit auf true
                // 2. Resource verf√ºgbar (cryptoAddonAvailable)
                const configEnabled = data.config?.AddonIntegration?.zs_crypto === true;
                const addonAvailable = data.cryptoAddonAvailable === true;
                
                console.log('üìã Config zs_crypto:', configEnabled);
                console.log('üìã Addon verf√ºgbar:', addonAvailable);
                
                if (configEnabled && addonAvailable) {
                    cryptoEnabled = true;
                    console.log('‚úÖ Crypto-System AKTIVIERT (Config=true, Addon=verf√ºgbar)');
                    
                    // Lade Crypto-Daten vom echten Addon
                    setTimeout(() => {
                        loadCryptoData();
                    }, 1000);
                } else {
                    cryptoEnabled = false;
                    if (!configEnabled) {
                        console.log('‚ùå Crypto-System DEAKTIVIERT: Config zs_crypto ist nicht auf true gesetzt');
                    }
                    if (!addonAvailable) {
                        console.log('‚ùå Crypto-System DEAKTIVIERT: zs_cryptoaddon Resource nicht verf√ºgbar');
                    }
                }
                
                // Setze die globale Variable
                window.cryptoAddonAvailable = cryptoEnabled;
                
                if (cryptoEnabled) {
                    console.log('‚úÖ Crypto-System verf√ºgbar');
                    
                    // Crypto-Tab anzeigen
                    const cryptoTab = document.getElementById('crypto-tab-btn');
                    if (cryptoTab) {
                        cryptoTab.style.display = 'inline-flex';
                        cryptoTab.classList.remove('hidden');
                        console.log('‚úÖ Crypto-Tab aktiviert');
                    }
                    
                    // Crypto-Schnellaktion anzeigen
                    const cryptoQuickAction = document.getElementById('crypto-quick-action');
                    if (cryptoQuickAction) {
                        cryptoQuickAction.style.display = 'block';
                        console.log('‚úÖ Crypto-Schnellaktion aktiviert');
                    }
                    
                    // Starte Crypto-Synchronisation
                    startCryptoHeartbeat();
                } else {
                    console.log('‚ùå Crypto-System nicht verf√ºgbar');
                    
                    // Crypto-Tab ausblenden
                    const cryptoTab = document.getElementById('crypto-tab-btn');
                    if (cryptoTab) {
                        cryptoTab.style.display = 'none';
                        cryptoTab.classList.add('hidden');
                        console.log('‚úÖ Crypto-Tab deaktiviert');
                    }
                    
                    // Crypto-Schnellaktion ausblenden
                    const cryptoQuickAction = document.getElementById('crypto-quick-action');
                    if (cryptoQuickAction) {
                        cryptoQuickAction.style.display = 'none';
                        console.log('‚úÖ Crypto-Schnellaktion deaktiviert');
                    }
                    
                    // Stoppe Crypto-Synchronisation
                    stopCryptoHeartbeat();
                }
                
                // Locales und Sprache setzen
                if (data.locales) {
                    window.Locales = data.locales;
                    console.log('‚úÖ Locales geladen:', Object.keys(window.Locales));
                }
                
                if (data.language) {
                    currentLanguage = data.language;
                    console.log('‚úÖ Sprache gesetzt:', currentLanguage);
                }
                
                // Banking Container anzeigen
                const container = document.getElementById('banking-container');
                if (container) {
                    container.classList.remove('hidden');
                    console.log('Banking Container angezeigt');
                }
                
                // Wenn der aktuelle Tab transactions ist, Transaktionen sofort laden
                if (currentTab === 'transactions') {
                    console.log('Transactions Tab ist aktiv - lade Transaktionen sofort');
                    setTimeout(() => {
                        loadTransactions();
                    }, 200);
                }
                
                // Spielerdaten setzen und UI aktualisieren
                if (data.name || data.cash !== undefined || data.bank !== undefined) {
                    console.log('=== SPIELERDATEN EMPFANGEN ===');
                    console.log('Vollst√§ndige Daten:', data);
                    console.log('Name:', data.name);
                    console.log('Name Typ:', typeof data.name);
                    console.log('Name L√§nge:', data.name ? data.name.length : 'undefined');
                    console.log('Cash:', data.cash);
                    console.log('Bank:', data.bank);
                    console.log('==============================');
                    
                    // Spielerdaten nach den √úbersetzungen setzen
                    setTimeout(() => {
                        // Spielerdaten global verf√ºgbar machen
                        window.playerData = {
                            name: data.name,
                            cash: data.cash,
                            bank: data.bank,
                            transactions: data.transactions
                        };
                        console.log('‚úÖ Spielerdaten global gesetzt:', window.playerData);
                        
                        // Alle UI-Elemente sofort aktualisieren
                        updateAllUI();
                        
                        // Transaktionen aktualisieren wenn vorhanden
                        if (data.transactions) {
                            console.log('‚úÖ Transaktionen aktualisiert:', data.transactions);
                            console.log('Transaktionen Typ:', typeof data.transactions);
                            
                            // Wenn es ein Objekt ist, zu Array konvertieren
                            if (typeof data.transactions === 'object' && !Array.isArray(data.transactions)) {
                                if (data.transactions.length !== undefined) {
                                    // Es ist ein Array-√§hnliches Objekt, zu Array konvertieren
                                    data.transactions = Array.from(data.transactions);
                                    console.log('Transaktionen zu Array konvertiert:', data.transactions);
                                } else {
                                    // Es ist ein leeres Objekt, zu leerem Array konvertieren
                                    data.transactions = [];
                                    console.log('Leeres Objekt zu leerem Array konvertiert');
                                }
                            }
                            
                            // Alle UI-Elemente sofort aktualisieren
                            updateAllUI();
                            
                            // Transaktionen sofort laden wenn im transactions Tab
                            if (currentTab === 'transactions') {
                                console.log('Aktueller Tab ist transactions - lade Transaktionen sofort');
                                setTimeout(() => {
                                    loadTransactions();
                                }, 100);
                            } else {
                                console.log('Aktueller Tab ist nicht transactions:', currentTab);
                            }
                        }
                    }, 100); // Kurze Verz√∂gerung nach den √úbersetzungen
                }
                
                // Debug-Config setzen
                if (data.debug) {
                    window.Config = { Debug: data.debug };
                    console.log('Debug-Config geladen:', window.Config.Debug);
                }
                
                // Locales laden
                if (data.locales) {
                    window.Locales = data.locales;
                    console.log('Locales geladen:', Object.keys(data.locales));
                }
                
                // Sprache setzen
                if (data.language) {
                    currentLanguage = data.language;
                    console.log('Sprache gesetzt:', currentLanguage);
                    
                    // √úbersetzungen anwenden
                    if (typeof changeLanguage === 'function') {
                        changeLanguage(currentLanguage);
                    } else {
                        console.log('changeLanguage Funktion nicht verf√ºgbar');
                    }
                }
                
                // Bank-Name setzen
                if (data.bankName) {
                    const bankNameElement = document.getElementById('bank-name');
                    if (bankNameElement) {
                        bankNameElement.textContent = data.bankName;
                        console.log('Bank-Name gesetzt:', data.bankName);
                    }
                }
                
                console.log('Banking UI erfolgreich ge√∂ffnet');
                
                // Auto-Update Timer starten
                // startAutoUpdate(); // Entfernt
            }
            
            // Crypto-Daten setzen (echtes Addon)
            if (data.action === 'setCryptoData') {
                console.log('=== Crypto-Daten vom echten Addon empfangen ===');
                window.cryptoData = data.cryptoData;
                
                // UI aktualisieren
                if (window.cryptoData) {
                    updateCryptoUI(window.cryptoData);
                    
                    // Standardm√§√üig Bitcoin ausw√§hlen
                    const currencySelect = document.getElementById('crypto-currency-select');
                    if (currencySelect) {
                        updateSelectedCurrencyDisplay(currencySelect.value);
                    }
                }
            }
            
            // Crypto-Daten aktualisieren
            if (data.action === 'updateCryptoData') {
                console.log('=== Crypto-Daten aktualisiert ===');
                if (data.data) {
                    window.cryptoData = data.data;
                    updateCryptoUI(data.data);
                }
            }
            
            // Crypto-Wallet aktualisieren
            if (data.action === 'updateCryptoWallet') {
                console.log('=== Crypto-Wallet aktualisiert ===');
                if (window.cryptoData && data.wallet) {
                    window.cryptoData.wallet = data.wallet;
                    
                    // Portfolio-Werte aktualisieren
                    updateCryptoPortfolioDisplay();
                    
                    // Aktuelle W√§hrungsanzeige aktualisieren
                    const currencySelect = document.getElementById('crypto-currency-select');
                    if (currencySelect) {
                        updateSelectedCurrencyDisplay(currencySelect.value);
                    }
                }
            }
            
            // Aktualisierungen f√ºr Spielerdaten
            if (data.action === 'updatePlayerData') {
                console.log('=== Player Data Update ===');
                console.log('Data:', data);
                
                // Transaktionen als Array konvertieren falls n√∂tig
                if (data.transactions) {
                    console.log('Transaktionen vor Konvertierung:', data.transactions);
                    console.log('Transaktionen Typ vor Konvertierung:', typeof data.transactions);
                    
                    // Wenn es ein Objekt ist, zu Array konvertieren
                    if (typeof data.transactions === 'object' && !Array.isArray(data.transactions)) {
                        if (data.transactions.length !== undefined) {
                            // Es ist ein Array-√§hnliches Objekt, zu Array konvertieren
                            data.transactions = Array.from(data.transactions);
                            console.log('Transaktionen zu Array konvertiert:', data.transactions);
                        } else {
                            // Es ist ein leeres Objekt, zu leerem Array konvertieren
                            data.transactions = [];
                            console.log('Leeres Objekt zu leerem Array konvertiert');
                        }
                    }
                    
                    console.log('Transaktionen nach Konvertierung:', data.transactions);
                    console.log('Transaktionen Typ nach Konvertierung:', typeof data.transactions);
                    console.log('Ist Array:', Array.isArray(data.transactions));
                }
                
                // Spielerdaten f√ºr lokalen Cache speichern
                if (data.name || data.cash !== undefined || data.bank !== undefined || data.transactions) {
                    if (!window.playerData) {
                        window.playerData = {};
                    }
                    
                    if (data.name) window.playerData.name = data.name;
                    if (data.cash !== undefined) window.playerData.cash = data.cash;
                    if (data.bank !== undefined) window.playerData.bank = data.bank;
                    if (data.transactions) window.playerData.transactions = data.transactions;
                    
                    console.log('‚úÖ Spielerdaten im Cache gespeichert:', window.playerData);
                }
                
                // Alle UI-Elemente sofort aktualisieren
                updateAllUI();
                
                // Auto-Update Timer starten falls noch nicht aktiv
                // if (!updateTimer) { // Entfernt
                //     console.log('üöÄ Starte Auto-Update Timer nach updatePlayerData');
                //     startAutoUpdate();
                // }
                
                // Zus√§tzliche Debug-Ausgaben
                if (data.name) {
                    console.log('Spielername aktualisiert:', data.name);
                }
                
                if (data.cash !== undefined) {
                    console.log('Bargeld aktualisiert:', data.cash);
                }
                
                if (data.bank !== undefined) {
                    console.log('Bankkonto aktualisiert:', data.bank);
                }
                
                if (data.transactions) {
                    console.log('Transaktionen aktualisiert:', data.transactions);
                    
                    // Transaktionen sofort laden wenn im transactions Tab
                    if (currentTab === 'transactions') {
                        console.log('Aktueller Tab ist transactions - lade Transaktionen sofort');
                        setTimeout(() => {
                            loadTransactions();
                        }, 100);
                    } else {
                        console.log('Aktueller Tab ist nicht transactions:', currentTab);
                    }
                }
            }
            
            // Aktualisierungen f√ºr Balances
            if (data.action === 'updateBalances') {
                console.log('=== Balance Update ===');
                console.log('Data:', data);
                
                // Alle UI-Elemente sofort aktualisieren
                updateAllUI();
                
                // Auto-Update Timer starten falls noch nicht aktiv
                // if (!updateTimer) { // Entfernt
                //     console.log('üöÄ Starte Auto-Update Timer nach updateBalances');
                //     startAutoUpdate();
                // }
                
                // Zus√§tzliche Debug-Ausgaben
                if (data.cash !== undefined) {
                    console.log('Bargeld aktualisiert:', data.cash);
                }
                
                if (data.bank !== undefined) {
                    console.log('Bankkonto aktualisiert:', data.bank);
                }
            }
            
            // Aktualisierungen f√ºr Transaktionen
            if (data.action === 'updateTransactions') {
                console.log('=== Transactions Update ===');
                console.log('Data:', data);
                
                if (data.transactions) {
                    console.log('Transaktionen vor Konvertierung:', data.transactions);
                    console.log('Transaktionen Typ vor Konvertierung:', typeof data.transactions);
                    
                    // Wenn es ein Objekt ist, zu Array konvertieren
                    if (typeof data.transactions === 'object' && !Array.isArray(data.transactions)) {
                        if (data.transactions.length !== undefined) {
                            // Es ist ein Array-√§hnliches Objekt, zu Array konvertieren
                            data.transactions = Array.from(data.transactions);
                            console.log('Transaktionen zu Array konvertiert:', data.transactions);
                        } else {
                            // Es ist ein leeres Objekt, zu leerem Array konvertieren
                            data.transactions = [];
                            console.log('Leeres Objekt zu leerem Array konvertiert');
                        }
                    }
                    
                    console.log('Transaktionen nach Konvertierung:', data.transactions);
                    console.log('Transaktionen aktualisiert:', data.transactions);
                    
                    // Alle UI-Elemente sofort aktualisieren
                    updateAllUI();
                    
                    // Auto-Update Timer starten falls noch nicht aktiv
                    // if (!updateTimer) { // Entfernt
                    //     console.log('üöÄ Starte Auto-Update Timer nach updateTransactions');
                    //     startAutoUpdate();
                    // }
                    
                    // Wenn der aktuelle Tab transactions ist, auch dort aktualisieren
                    if (currentTab === 'transactions') {
                        console.log('Transactions Tab ist aktiv - aktualisiere sofort');
                        setTimeout(() => {
                            loadTransactions();
                        }, 100);
                    }
                }
            }
            
            // √úberweisung abgeschlossen
            if (data.action === 'transferCompleted') {
                console.log('=== Transfer Completed ===');
                console.log('Is Sender:', data.isSender);
                console.log('Amount:', data.amount);
                console.log('Target Name:', data.targetName);
                
                // UI sofort aktualisieren
                if (window.playerData) {
                    updatePlayerName();
                    updateCash();
                    updateBank();
                    updateTransactions();
                }
                
                // Erfolgsmeldung anzeigen
                const message = data.isSender ? 
                    `√úberweisung erfolgreich! $${data.amount} an ${data.targetName}` :
                    `√úberweisung erhalten! $${data.amount} von ${data.targetName}`;
                const type = 'success';
                showNotification(message, type);
            }
            
            // Benachrichtigungen anzeigen
            if (data.action === 'showNotification') {
                console.log('=== Notification ===');
                console.log('Message:', data.message);
                console.log('Type:', data.type);
                
                // √úbersetzte Nachricht anzeigen
                const message = getTranslation(data.message) || data.message;
                showNotification(message, data.type);
            }
            
            // ========================================
            // CRYPTO EVENT HANDLERS (zs_crypto Integration)
            // ========================================
            
            // Crypto-Daten aktualisieren
            if (data.action === 'updateCryptoData') {
                console.log('=== Crypto Data Update ===');
                console.log('Data:', data.data);
                updateCryptoUI(data.data);
            }
            
            // Crypto-Wallet aktualisieren
            if (data.action === 'updateCryptoWallet') {
                console.log('=== Crypto Wallet Update ===');
                console.log('Wallet:', data.wallet);
                updateCryptoWallet(data.wallet);
            }
            
            // Crypto-Status aktualisieren
            if (data.action === 'updateCryptoStatus') {
                console.log('=== Crypto Status Update ===');
                console.log('Status:', data.status);
                updateCryptoStatus(data.status);
            }
            
            // Crypto-Informationen aktualisieren
            if (data.action === 'updateCryptoInfo') {
                console.log('=== Crypto Info Update ===');
                console.log('Info:', data.info);
                updateCryptoInfo(data.info);
            }
        });
        
        // √úbersetzungen beim Laden der Seite anwenden
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Banking UI geladen');
            updateUILanguage();
            
            // Standard-Tab aktivieren
            switchTab('overview');
        });
        
        // Funktion zum √Ñndern der Sprache
        function changeLanguage(language) {
            console.log('=== changeLanguage aufgerufen mit:', language, '===');
            console.log('Locales:', window.Locales);
            console.log('currentLanguage:', currentLanguage);
            
            if (!window.Locales || !window.Locales[language]) {
                console.log('Sprache nicht verf√ºgbar:', language);
                console.log('Verf√ºgbare Sprachen:', window.Locales ? Object.keys(window.Locales).join(', ') : 'Keine');
                
                // Fallback auf deutsche Sprache wenn verf√ºgbar
                if (window.Locales && window.Locales['de']) {
                    console.log('Fallback auf deutsche Sprache');
                    language = 'de';
                } else {
                    console.log('Keine geeignete Sprache gefunden, verwende Standard-Texte');
                    return;
                }
            }
            
            currentLanguage = language;
            console.log('Sprache ge√§ndert zu:', currentLanguage);
            updateUILanguage();
        }
        
        // Funktion zum Testen der √úbersetzungen
        function testTranslations() {
            console.log('=== √úbersetzungstest ===');
            console.log('Aktuelle Sprache:', currentLanguage);
            console.log('Verf√ºgbare Sprachen:', window.Locales ? Object.keys(window.Locales) : 'Keine');
            console.log('Aktuelle √úbersetzungen:', window.Locales && window.Locales[currentLanguage] ? window.Locales[currentLanguage] : 'Keine');
        }
        
        // Einzelne UI-Update-Funktionen
        function updatePlayerName() {
            if (window.playerData && window.playerData.name) {
                const playerNameElement = document.getElementById('overview-player-name');
                if (playerNameElement) {
                    playerNameElement.textContent = `üë§ ${window.playerData.name}`;
                    console.log('‚úÖ Spielername aktualisiert:', window.playerData.name);
                }
            }
        }
        
        function updateCash() {
            if (window.playerData && window.playerData.cash !== undefined) {
                const cashElement = document.getElementById('overview-cash-balance');
                if (cashElement) {
                    cashElement.textContent = 'üíµ $' + (window.playerData.cash || 0).toLocaleString();
                    console.log('‚úÖ Bargeld aktualisiert:', window.playerData.cash);
                }
            }
        }
        
        function updateBank() {
            if (window.playerData && window.playerData.bank !== undefined) {
                const bankElement = document.getElementById('overview-bank-balance');
                if (bankElement) {
                    bankElement.textContent = 'üè¶ $' + (window.playerData.bank || 0).toLocaleString();
                    console.log('‚úÖ Bankkonto aktualisiert:', window.playerData.bank);
                }
            }
        }
        
        // Transaktionen aktualisieren
        function updateTransactions() {
            if (window.playerData && window.playerData.transactions) {
                console.log('=== updateTransactions aufgerufen ===');
                console.log('Transaktionen:', window.playerData.transactions);
                
                // Transaktionen in der √úbersicht aktualisieren
                updateOverviewTransactions(window.playerData.transactions);
                
                // Wenn im transactions Tab, auch dort aktualisieren
                if (currentTab === 'transactions') {
                    loadTransactions();
                }
            } else {
                console.log('‚ùå Keine Transaktionsdaten f√ºr Update verf√ºgbar');
            }
        }
        
        // Transaktionen in der √úbersicht anzeigen
        function updateOverviewTransactions(transactions) {
            console.log('=== updateOverviewTransactions aufgerufen ===');
            console.log('Transaktionen:', transactions);
            console.log('Transaktionen Typ:', typeof transactions);
            console.log('Transaktionen L√§nge:', transactions?.length);
            
            // Transaktionen als Array konvertieren falls n√∂tig
            if (transactions && typeof transactions === 'object' && !Array.isArray(transactions)) {
                if (transactions.length !== undefined) {
                    // Es ist ein Array-√§hnliches Objekt, zu Array konvertieren
                    transactions = Array.from(transactions);
                    console.log('Transaktionen zu Array konvertiert:', transactions);
                } else {
                    // Es ist ein leeres Objekt, zu leerem Array konvertieren
                    transactions = [];
                    console.log('Leeres Objekt zu leerem Array konvertiert');
                }
            }
            
            // Pr√ºfen ob Transaktionen vorhanden sind
            if (!transactions) {
                console.log('Keine Transaktionen f√ºr √úbersicht verf√ºgbar (null/undefined)');
                // √úbersicht leeren
                const lastTransactionElement = document.getElementById('overview-last-transaction');
                if (lastTransactionElement) {
                    lastTransactionElement.innerHTML = '<div style="color: #888888; font-style: italic;">Keine Transaktionen verf√ºgbar</div>';
                }
                return;
            }
            
            // Wenn es ein Array ist, die letzte Transaktion nehmen
            let lastTransaction;
            if (Array.isArray(transactions)) {
                if (transactions.length === 0) {
                    console.log('Transaktionsarray ist leer');
                    // √úbersicht leeren
                    const lastTransactionElement = document.getElementById('overview-last-transaction');
                    if (lastTransactionElement) {
                        lastTransactionElement.innerHTML = '<div style="color: #888888; font-style: italic;">Keine Transaktionen verf√ºgbar</div>';
                    }
                    return;
                }
                lastTransaction = transactions[transactions.length - 1];
            } else if (typeof transactions === 'object') {
                // Wenn es ein einzelnes Objekt ist
                lastTransaction = transactions;
            } else {
                console.log('Transaktionen sind weder Array noch Objekt:', transactions);
                return;
            }
            
            console.log('Letzte Transaktion:', lastTransaction);
            
            const lastTransactionElement = document.getElementById('overview-last-transaction');
            
            if (lastTransactionElement && lastTransaction) {
                const icon = lastTransaction.type === 'deposit' ? 'üí∞' : 
                            lastTransaction.type === 'withdraw' ? 'üí∏' : 
                            lastTransaction.type === 'transfer_sent' ? 'üîÑ' :
                            lastTransaction.type === 'transfer_received' ? '‚úÖ' : 'üîÑ';
                
                const typeText = lastTransaction.type === 'deposit' ? (getTranslation('deposit_type') || 'Einzahlung') :
                                lastTransaction.type === 'withdraw' ? (getTranslation('withdraw_type') || 'Abhebung') :
                                lastTransaction.type === 'transfer_sent' ? (getTranslation('transfer_sent_type') || '√úberweisung gesendet') :
                                lastTransaction.type === 'transfer_received' ? (getTranslation('transfer_received_type') || '√úberweisung erhalten') : 'Transaktion';
                
                lastTransactionElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 20px;">${icon}</span>
                        <div>
                            <div style="color: #ffffff; font-weight: bold; font-size: 14px;">${typeText}</div>
                            <div style="color: #4CAF50; font-size: 16px;">$${lastTransaction.amount || 0}</div>
                            <div style="color: #888888; font-size: 12px;">${lastTransaction.date || 'Unbekannt'}</div>
                        </div>
                    </div>
                `;
                console.log('‚úÖ Letzte Transaktion in √úbersicht aktualisiert:', lastTransaction);
            } else {
                console.log('‚ùå Letzte Transaktion Element nicht gefunden oder keine Transaktion verf√ºgbar');
            }
        }
        
        // Transaktionen laden
        function loadTransactions() {
            console.log('=== loadTransactions aufgerufen ===');
            console.log('PlayerData:', window.playerData);
            console.log('PlayerData.transactions:', window.playerData?.transactions);
            console.log('PlayerData.transactions Typ:', typeof window.playerData?.transactions);
            console.log('PlayerData.transactions L√§nge:', window.playerData?.transactions?.length);
            
            if (!window.playerData) {
                console.log('‚ùå Keine Spielerdaten verf√ºgbar');
                return;
            }
            
            if (!window.playerData.transactions) {
                console.log('‚ùå Keine Transaktionen in den Spielerdaten');
                return;
            }
            
            // Transaktionen als Array konvertieren falls n√∂tig
            let transactions = window.playerData.transactions;
            if (transactions && typeof transactions === 'object' && !Array.isArray(transactions)) {
                if (transactions.length !== undefined) {
                    // Es ist ein Array-√§hnliches Objekt, zu Array konvertieren
                    transactions = Array.from(transactions);
                    console.log('Transaktionen zu Array konvertiert:', transactions);
                    // Aktualisiere die Spielerdaten
                    window.playerData.transactions = transactions;
                } else {
                    // Es ist ein leeres Objekt, zu leerem Array konvertieren
                    transactions = [];
                    console.log('Leeres Objekt zu leerem Array konvertiert');
                    // Aktualisiere die Spielerdaten
                    window.playerData.transactions = transactions;
                }
            } else {
                transactions = window.playerData.transactions;
            }
            
            if (!Array.isArray(transactions)) {
                console.log('‚ùå Transaktionen sind immer noch kein Array:', transactions);
                return;
            }
            
            const transactionsList = document.getElementById('transactions-list');
            const noTransactions = document.getElementById('no-transactions');
            
            console.log('Transaktionsliste-Element:', transactionsList);
            console.log('Keine-Transaktionen-Element:', noTransactions);
            
            if (!transactionsList) {
                console.log('‚ùå Transaktionsliste-Element nicht gefunden');
                return;
            }
            
            console.log('‚úÖ Lade Transaktionen:', transactions);
            console.log('Anzahl Transaktionen:', transactions.length);
            
            // Alle Transaktionen entfernen
            transactionsList.innerHTML = '';
            
            if (transactions.length === 0) {
                if (noTransactions) {
                    noTransactions.style.display = 'block';
                    console.log('‚úÖ Keine-Transaktionen-Nachricht angezeigt');
                }
                console.log('‚ÑπÔ∏è Keine Transaktionen verf√ºgbar');
                return;
            }
            
            if (noTransactions) {
                noTransactions.style.display = 'none';
                console.log('‚úÖ Keine-Transaktionen-Nachricht ausgeblendet');
            }
            
            // Transaktionen anzeigen
            let loadedCount = 0;
            transactions.forEach((transaction, index) => {
                console.log(`Verarbeite Transaktion ${index + 1}:`, transaction);
                
                const transactionElement = document.createElement('div');
                transactionElement.className = 'transaction-item';
                transactionElement.style.cssText = `
                    display: flex;
                    align-items: center;
                    padding: 15px;
                    margin: 10px 0;
                    background: #2a2a2a;
                    border-radius: 8px;
                    border-left: 4px solid #4CAF50;
                `;
                
                const icon = transaction.type === 'deposit' ? 'üí∞' : 
                            transaction.type === 'withdraw' ? 'üí∏' : 
                            transaction.type === 'transfer_sent' ? 'üîÑ' :
                            transaction.type === 'transfer_received' ? '‚úÖ' : 'üîÑ';
                
                transactionElement.innerHTML = `
                    <div style="font-size: 24px; margin-right: 15px;">${icon}</div>
                    <div style="flex: 1;">
                        <div style="color: #ffffff; font-weight: bold; margin-bottom: 5px;">${transaction.type || 'Unbekannt'}</div>
                        <div style="color: #4CAF50; font-size: 18px; margin-bottom: 5px;">$${transaction.amount || 0}</div>
                        <div style="color: #888888; font-size: 14px;">${transaction.date || 'Unbekannt'}</div>
                    </div>
                `;
                
                transactionsList.appendChild(transactionElement);
                loadedCount++;
                console.log(`‚úÖ Transaktion ${index + 1} hinzugef√ºgt:`, transaction);
            });
            
            console.log(`üéØ Transaktionen geladen: ${loadedCount}/${transactions.length}`);
        }
        
        // Aktueller Tab
        let currentTab = 'overview';
        
        // FiveM Resource Name Funktion
        function GetParentResourceName() {
            return 'zs_banking';
        }
        
        // Fallback-Locales (falls NUI-Loading fehlschl√§gt)
        if (!window.Locales) {
            console.log('üîÑ Initialisiere Fallback-Locales...');
            window.Locales = {
                'de': {
                    'page_title': 'ZS Banking System',
                    'bank_name': 'üè¶ ZS BANKING SYSTEM',
                    'overview': 'üìä √úBERSICHT',
                    'deposit_tab': 'üí∞ EINZAHLEN',
                    'withdraw_tab': 'üí∏ ABHEBEN',
                    'transfer_tab': 'üîÑ √úBERWEISEN',
                    'transactions_tab': 'üìã VERLAUF',
                    'crypto_tab': '‚Çø CRYPTO',
                    'player_label': 'SPIELER',
                    'last_transaction': 'LETZTE TRANSAKTION',
                    'cash_text': 'BARGELD',
                    'bank_text': 'BANKKONTO',
                    'quick_actions': '‚ö° SCHNELLAKTIONEN',
                    'amount': 'üíµ BETRAG:',
                    'amount_placeholder': 'Betrag eingeben',
                    'player_id': 'üë§ SPIELER-ID:',
                    'player_id_placeholder': 'Spieler-ID eingeben',
                    'deposit_title': 'üí∞ GELD EINZAHLEN',
                    'deposit_btn': 'üí∞ EINZAHLEN',
                    'withdraw_title': 'üí∏ GELD ABHEBEN',
                    'withdraw_btn': 'üí∏ ABHEBEN',
                    'transfer_title': 'üîÑ GELD √úBERWEISEN',
                    'transfer_btn': 'üîÑ √úBERWEISEN',
                    'close_btn': '‚ùå SCHLIE√üEN',
                    'error_invalid_amount': '‚ùå Ung√ºltiger Betrag!',
                    'error_invalid_player_id': '‚ùå Ung√ºltige Spieler-ID!',
                    'deposit_type': 'Einzahlung',
                    'withdraw_type': 'Abhebung',
                    'transfer_sent_type': '√úberweisung gesendet',
                    'transfer_received_type': '√úberweisung erhalten',
                    'success_transfer_fee': '√úberweisung erfolgreich!',
                    'transactions_title': 'üìú TRANSAKTIONSVERLAUF',
                    'no_transactions_text': 'üìù KEINE TRANSAKTIONEN VERF√úGBAR',
                    'crypto_title': '‚Çø CRYPTO VERWALTUNG',
                    'crypto_balance': 'CRYPTO PORTFOLIO',
                    'crypto_profit': 'GEWINN/VERLUST',
                    'crypto_select_currency': 'KRYPTOW√ÑHRUNG W√ÑHLEN',
                    'crypto_current_price': 'Aktueller Preis:',
                    'crypto_your_holdings': 'Ihre Best√§nde:',
                    'crypto_price': 'AKTUELLER PREIS',
                    'crypto_buy': 'CRYPTO KAUFEN',
                    'crypto_sell': 'CRYPTO VERKAUFEN',
                    'crypto_amount': 'üíµ BETRAG IN USD:',
                    'crypto_fee': 'Geb√ºhr:',
                    'crypto_total': 'Gesamt:',
                    'crypto_amount_crypto': 'üíé CRYPTO BETRAG:',
                    'crypto_value': 'Wert:',
                    'crypto_buy_btn': 'üí∞ KAUFEN',
                    'crypto_sell_btn': 'üíµ VERKAUFEN',
                    'crypto_history': 'CRYPTO VERLAUF',
                    'no_crypto_transactions_text': 'üìù Keine Crypto-Transaktionen vorhanden',
                    
                    // Neue moderne UI-√úbersetzungen
                    'trading': 'Handel',
                    'charts': 'Charts',
                    'portfolio': 'Portfolio',
                    'staking': 'Staking',
                    'contests': 'Wettbewerbe',
                    'insights': 'Einblicke',
                    'portfolio_value': 'Portfolio-Wert',
                    'profit_loss_24h': '24h Gewinn/Verlust',
                    'trades_today': 'Trades heute',
                    'available_cash': 'Verf√ºgbares Bargeld',
                    'market_overview': 'Markt√ºbersicht',
                    'refresh_market': 'Markt aktualisieren',
                    'last_updated': 'Zuletzt aktualisiert',
                    'quick_actions': 'Schnellaktionen',
                    'buy_crypto': 'Crypto kaufen',
                    'sell_crypto': 'Crypto verkaufen',
                    'view_portfolio': 'Portfolio anzeigen',
                    'performance_stats': 'Performance-Statistiken',
                    'total_invested': 'Gesamt investiert',
                    'total_profit': 'Gesamtgewinn',
                    'win_rate': 'Gewinnrate',
                    'avg_trade': 'Durchschnittlicher Trade'
                },
                'en': {
                    'page_title': 'ZS Banking System',
                    'bank_name': 'üè¶ ZS BANKING SYSTEM',
                    'overview': 'üìä OVERVIEW',
                    'deposit_tab': 'üí∞ DEPOSIT',
                    'withdraw_tab': 'üí∏ WITHDRAW',
                    'transfer_tab': 'üîÑ TRANSFER',
                    'transactions_tab': 'üìã TRANSACTIONS',
                    'crypto_tab': '‚Çø CRYPTO',
                    'player_label': 'PLAYER',
                    'last_transaction': 'LAST TRANSACTION',
                    'cash_text': 'CASH',
                    'bank_text': 'BANK ACCOUNT',
                    'quick_actions': '‚ö° QUICK ACTIONS',
                    'amount': 'üíµ AMOUNT:',
                    'amount_placeholder': 'Enter amount',
                    'player_id': 'üë§ PLAYER-ID:',
                    'player_id_placeholder': 'Enter player ID',
                    'deposit_title': 'üí∞ DEPOSIT MONEY',
                    'deposit_btn': 'üí∞ DEPOSIT',
                    'withdraw_title': 'üí∏ WITHDRAW MONEY',
                    'withdraw_btn': 'üí∏ WITHDRAW',
                    'transfer_title': 'üîÑ TRANSFER MONEY',
                    'transfer_btn': 'üîÑ TRANSFER',
                    'close_btn': '‚ùå CLOSE',
                    'error_invalid_amount': '‚ùå Invalid amount!',
                    'error_invalid_player_id': '‚ùå Invalid player ID!',
                    'deposit_type': 'Deposit',
                    'withdraw_type': 'Withdrawal',
                    'transfer_sent_type': 'Transfer Sent',
                    'transfer_received_type': 'Transfer Received',
                    'success_transfer_fee': 'Transfer successful!',
                    'transactions_title': 'üìú TRANSACTION HISTORY',
                    'no_transactions_text': 'üìù NO TRANSACTIONS AVAILABLE',
                    'crypto_title': '‚Çø CRYPTO MANAGEMENT',
                    'crypto_balance': 'CRYPTO PORTFOLIO',
                    'crypto_profit': 'PROFIT/LOSS',
                    'crypto_select_currency': 'SELECT CRYPTOCURRENCY',
                    'crypto_current_price': 'Current Price:',
                    'crypto_your_holdings': 'Your Holdings:',
                    'crypto_price': 'CURRENT PRICE',
                    'crypto_buy': 'BUY CRYPTO',
                    'crypto_sell': 'SELL CRYPTO',
                    'crypto_amount': 'üíµ AMOUNT IN USD:',
                    'crypto_fee': 'Fee:',
                    'crypto_total': 'Total:',
                    'crypto_amount_crypto': 'üíé CRYPTO AMOUNT:',
                    'crypto_value': 'Value:',
                    'crypto_buy_btn': 'üí∞ BUY',
                    'crypto_sell_btn': 'üíµ SELL',
                    'crypto_history': 'CRYPTO HISTORY',
                    'no_crypto_transactions_text': 'üìù No crypto transactions available',
                    
                    // New modern UI translations
                    'trading': 'Trading',
                    'charts': 'Charts',
                    'portfolio': 'Portfolio',
                    'staking': 'Staking',
                    'contests': 'Contests',
                    'insights': 'Insights',
                    'portfolio_value': 'Portfolio Value',
                    'profit_loss_24h': '24h Profit/Loss',
                    'trades_today': 'Trades Today',
                    'available_cash': 'Available Cash',
                    'market_overview': 'Market Overview',
                    'refresh_market': 'Refresh Market',
                    'last_updated': 'Last Updated',
                    'quick_actions': 'Quick Actions',
                    'buy_crypto': 'Buy Crypto',
                    'sell_crypto': 'Sell Crypto',
                    'view_portfolio': 'View Portfolio',
                    'performance_stats': 'Performance Statistics',
                    'total_invested': 'Total Invested',
                    'total_profit': 'Total Profit',
                    'win_rate': 'Win Rate',
                    'avg_trade': 'Average Trade'
                }
            };
            console.log('‚úÖ Fallback-Locales geladen');
        }
        
        // Globale Funktionen verf√ºgbar machen
        window.changeLanguage = changeLanguage;
        window.testTranslations = testTranslations;
        window.getTranslation = getTranslation;
        window.loadTransactions = loadTransactions;
        window.updateOverviewTransactions = updateOverviewTransactions;
        window.loadCryptoData = loadCryptoData;
        window.buyCrypto = buyCrypto;
        window.sellCrypto = sellCrypto;
        
        // Funktion zum Aktualisieren aller UI-Elemente (nur bei Bedarf)
        function updateAllUI() {
            console.log('=== updateAllUI aufgerufen ===');
            
            if (window.playerData) {
                console.log('Spielerdaten gefunden:', window.playerData);
                
                // Spielername aktualisieren
                const playerNameElement = document.getElementById('overview-player-name');
                if (playerNameElement) {
                    playerNameElement.textContent = `üë§ ${window.playerData.name || 'Unbekannt'}`;
                    console.log('‚úÖ Spielername aktualisiert:', window.playerData.name);
                } else {
                    console.log('‚ùå Spielername-Element nicht gefunden');
                }
                
                // Bargeld aktualisieren
                const cashElement = document.getElementById('overview-cash-balance');
                if (cashElement) {
                    cashElement.textContent = 'üíµ $' + (window.playerData.cash || 0).toLocaleString();
                    console.log('‚úÖ Bargeld aktualisiert:', window.playerData.cash);
                } else {
                    console.log('‚ùå Bargeld-Element nicht gefunden');
                }
                
                // Bankkonto aktualisieren - Debug verbessert
                const bankElement = document.getElementById('overview-bank-balance');
                if (bankElement) {
                    const bankAmount = window.playerData.bank || 0;
                    bankElement.textContent = 'üè¶ $' + bankAmount.toLocaleString();
                    console.log('‚úÖ Bankkonto aktualisiert:', bankAmount);
                } else {
                    console.log('‚ùå Bankkonto-Element nicht gefunden');
                }
                
                // Transaktionen aktualisieren
                if (window.playerData.transactions) {
                    console.log('Transaktionen gefunden:', window.playerData.transactions);
                    updateOverviewTransactions(window.playerData.transactions);
                    
                    // Wenn im transactions Tab, auch dort aktualisieren
                    if (currentTab === 'transactions') {
                        console.log('Transactions Tab aktiv - lade Transaktionen');
                        loadTransactions();
                    }
                } else {
                    console.log('‚ùå Keine Transaktionen in den Spielerdaten');
                    // √úbersicht leeren
                    const lastTransactionElement = document.getElementById('overview-last-transaction');
                    if (lastTransactionElement) {
                        lastTransactionElement.innerHTML = '<div style="color: #888888; font-style: italic;">Keine Transaktionen verf√ºgbar</div>';
                    }
                }
                
                console.log('‚úÖ Alle UI-Elemente aktualisiert');
            } else {
                console.log('‚ùå Keine Spielerdaten verf√ºgbar f√ºr UI-Update');
            }
        }
        
        // Banking-Funktionen
        function switchTab(tabName) {
            console.log('Wechsle zu Tab:', tabName);
            
            // Aktuellen Tab setzen
            currentTab = tabName;
            
            // Alle Tabs ausblenden
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
                tab.classList.remove('active');
            });
            
            // Alle Tab-Buttons deaktivieren
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.classList.remove('active');
            });
            
            // Gew√§hlten Tab aktivieren
            const selectedTab = document.getElementById(tabName);
            const selectedButton = document.querySelector(`[data-tab="${tabName}"]`);
            
            if (selectedTab) {
                selectedTab.style.display = 'block';
                selectedTab.classList.add('active');
                console.log('Tab aktiviert:', tabName);
            } else {
                console.error('Tab nicht gefunden:', tabName);
            }
            
            if (selectedButton) {
                selectedButton.classList.add('active');
                console.log('Button aktiviert:', tabName);
            } else {
                console.error('Button nicht gefunden:', tabName);
            }
            
            // Transaktionen laden wenn im transactions Tab
            if (tabName === 'transactions') {
                console.log('Transactions Tab aktiviert - lade Transaktionen sofort');
                // Kurze Verz√∂gerung um sicherzustellen, dass der Tab sichtbar ist
                setTimeout(() => {
                    loadTransactions();
                }, 100);
            }
            
            // √úbersicht aktualisieren wenn im overview Tab
            if (tabName === 'overview') {
                console.log('Overview Tab aktiviert - aktualisiere √úbersicht sofort');
                setTimeout(() => {
                    updateAllUI();
                }, 100);
            }
            
            // Crypto-Daten laden wenn im crypto Tab
            if (tabName === 'crypto') {
                console.log('Crypto Tab aktiviert - lade Crypto-Daten sofort');
                setTimeout(() => {
                    loadCryptoData();
                    // Load modern dashboard after crypto data is loaded
                    setTimeout(() => {
                        loadModernDashboard();
                    }, 200);
                }, 100);
            }
        }
        
        function closeBanking() {
            console.log('=== Banking UI schlie√üen ===');
            
            // Auto-Update Timer stoppen
            // stopAutoUpdate(); // Entfernt
            
            // Spielerdaten zur√ºcksetzen
            if (window.playerData) {
                console.log('üóëÔ∏è Spielerdaten zur√ºckgesetzt');
                window.playerData = null;
            }
            
            // Banking UI schlie√üen
            const container = document.getElementById('banking-container');
            if (container) {
                container.classList.add('hidden');
                console.log('‚úÖ Banking Container ausgeblendet');
            }
            
            // NUI-Nachricht an Lua senden
            if (typeof fetch !== 'undefined') {
                fetch(`https://${GetParentResourceName()}/closeBanking`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
            }
        }
        
        // Banking-Funktionen
        function deposit() {
            const amountElement = document.getElementById('deposit-amount');
            if (!amountElement) return;
            
            const amount = parseInt(amountElement.value);
            if (!amount || amount <= 0) {
                const message = getTranslation('error_invalid_amount') || 'BITTE GEBEN SIE EINEN G√úLTIGEN BETRAG EIN!';
                showNotification(message, 'error');
                return;
            }
            
            // Erfolgsbenachrichtigung anzeigen
            const successMessage = getTranslation('success_deposit_free') || 'Einzahlung erfolgreich!';
            showNotification(successMessage, 'success');
            
            // NUI-Nachricht an Lua senden
            if (typeof fetch !== 'undefined') {
                fetch(`https://${GetParentResourceName()}/deposit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: amount })
                });
            }
            
            amountElement.value = '';
        }
        
        function withdraw() {
            const amountElement = document.getElementById('withdraw-amount');
            if (!amountElement) return;
            
            const amount = parseInt(amountElement.value);
            if (!amount || amount <= 0) {
                const message = getTranslation('error_invalid_amount') || 'BITTE GEBEN SIE EINEN G√úLTIGEN BETRAG EIN!';
                showNotification(message, 'error');
                return;
            }
            
            // Erfolgsbenachrichtigung anzeigen
            const successMessage = getTranslation('success_withdraw_free') || 'Abhebung erfolgreich!';
            showNotification(successMessage, 'success');
            
            // NUI-Nachricht an Lua senden
            if (typeof fetch !== 'undefined') {
                fetch(`https://${GetParentResourceName()}/withdraw`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: amount })
                });
            }
            
            amountElement.value = '';
        }
        
        function transfer() {
            const playerIdElement = document.getElementById('transfer-player');
            const amountElement = document.getElementById('transfer-amount');
            
            if (!playerIdElement || !amountElement) return;
            
            const playerId = parseInt(playerIdElement.value);
            const amount = parseInt(amountElement.value);
            
            if (!playerId || playerId <= 0) {
                const message = getTranslation('error_invalid_player_id') || 'BITTE GEBEN SIE EINE G√úLTIGE SPIELER-ID EIN!';
                showNotification(message, 'error');
                return;
            }
            
            if (!amount || amount <= 0) {
                const message = getTranslation('error_invalid_amount') || 'BITTE GEBEN SIE EINEN G√úLTIGEN BETRAG EIN!';
                showNotification(message, 'error');
                return;
            }
            
            // Lade-Animation anzeigen
            showNotification('üîÑ √úberweisung wird verarbeitet...', 'info');
            
            // NUI-Nachricht an Lua senden
            if (typeof fetch !== 'undefined') {
                fetch(`https://${GetParentResourceName()}/transfer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        target: playerId, 
                        amount: amount,
                        reason: '√úberweisung'
                    })
                }).then(response => {
                    // Erfolgsmeldung wird vom Server gesendet
                    console.log('‚úÖ √úberweisung erfolgreich gesendet');
                }).catch(error => {
                    console.error('‚ùå Fehler bei der √úberweisung:', error);
                    showNotification('‚ùå Fehler bei der √úberweisung!', 'error');
                });
            }
            
            playerIdElement.value = '';
            amountElement.value = '';
        }
        
        // Crypto-Funktionen
        function loadCryptoData() {
            console.log('=== loadCryptoData aufgerufen ===');
            
            // Pr√ºfe ob Crypto-Addon verf√ºgbar ist
            if (!window.cryptoAddonAvailable) {
                console.log('‚ùå Crypto-Addon nicht verf√ºgbar');
                showNotification('Crypto-Funktionen sind nicht verf√ºgbar', 'warning');
                return;
            }
            
            // Crypto-Daten vom echten Addon laden
            console.log('‚úÖ Lade echte Crypto-Daten vom zs_cryptoaddon...');
            
            // Use NUI callback to get crypto data
            if (window.invokeNative) {
                window.invokeNative('getCryptoData', {});
            } else {
                // Fallback: simulate data loading
                console.log('üîÑ Fallback: Simuliere Crypto-Daten...');
                setTimeout(() => {
                    if (window.cryptoData) {
                        console.log('‚úÖ Crypto-Daten bereits verf√ºgbar:', window.cryptoData);
                        updateCryptoUI(window.cryptoData);
                    } else {
                        console.log('‚ùå Keine Crypto-Daten verf√ºgbar');
                        showNotification('Crypto-System ist nicht verf√ºgbar', 'error');
                    }
                }, 500);
            }
        }
        
        // Kryptow√§hrung-Auswahl aktualisieren
        function updateCryptoSelection() {
            const select = document.getElementById('crypto-currency-select');
            if (!select) return;
            
            const selectedCurrency = select.value;
            console.log('Kryptow√§hrung ausgew√§hlt:', selectedCurrency);
            
            // Preis und Best√§nde f√ºr ausgew√§hlte W√§hrung anzeigen
            updateSelectedCurrencyDisplay(selectedCurrency);
        }
        
        // Anzeige f√ºr ausgew√§hlte Kryptow√§hrung aktualisieren
        function updateSelectedCurrencyDisplay(currency) {
            if (!window.cryptoData) return;
            
            const priceElement = document.getElementById('selected-crypto-price');
            const holdingsElement = document.getElementById('selected-crypto-holdings');
            const buyFeeElement = document.getElementById('crypto-buy-fee');
            
            if (window.cryptoData.prices && window.cryptoData.prices[currency]) {
                const price = window.cryptoData.prices[currency];
                if (priceElement) {
                    priceElement.textContent = '$' + price.toLocaleString();
                }
            }
            
            if (window.cryptoData.wallet && window.cryptoData.wallet.holdings && window.cryptoData.wallet.holdings[currency]) {
                const holdings = window.cryptoData.wallet.holdings[currency];
                if (holdingsElement) {
                    holdingsElement.textContent = holdings.toFixed(8);
                }
            } else {
                if (holdingsElement) {
                    holdingsElement.textContent = '0.00000000';
                }
            }
            
            // Geb√ºhr anzeigen
            if (window.cryptoData.currencies && window.cryptoData.currencies[currency]) {
                const fee = window.cryptoData.currencies[currency].fee * 100;
                if (buyFeeElement) {
                    buyFeeElement.textContent = fee.toFixed(2) + '%';
                }
            }
            
            // Kauf-/Verkaufsberechnungen aktualisieren
            updateCryptoBuyCalculation();
            updateCryptoSellCalculation();
        }
        
        // Kauf-Berechnung aktualisieren
        function updateCryptoBuyCalculation() {
            const amountElement = document.getElementById('crypto-buy-amount');
            const totalElement = document.getElementById('crypto-buy-total');
            const currencySelect = document.getElementById('crypto-currency-select');
            
            if (!amountElement || !totalElement || !currencySelect) return;
            
            const amount = parseFloat(amountElement.value) || 0;
            const currency = currencySelect.value;
            
            if (window.cryptoData && window.cryptoData.currencies && window.cryptoData.currencies[currency]) {
                const fee = window.cryptoData.currencies[currency].fee;
                const total = amount * (1 + fee);
                totalElement.textContent = '$' + total.toFixed(2);
            }
        }
        
        // Verkaufs-Berechnung aktualisieren
        function updateCryptoSellCalculation() {
            const amountElement = document.getElementById('crypto-sell-amount');
            const valueElement = document.getElementById('crypto-sell-value');
            const currencySelect = document.getElementById('crypto-currency-select');
            
            if (!amountElement || !valueElement || !currencySelect) return;
            
            const amount = parseFloat(amountElement.value) || 0;
            const currency = currencySelect.value;
            
            if (window.cryptoData && window.cryptoData.prices && window.cryptoData.prices[currency]) {
                const price = window.cryptoData.prices[currency];
                const value = amount * price;
                valueElement.textContent = '$' + value.toFixed(2);
            }
        }
        
        // Portfolio-Anzeige aktualisieren
        function updateCryptoPortfolioDisplay() {
            if (!window.cryptoData || !window.cryptoData.wallet) return;
            
            const portfolioElement = document.getElementById('crypto-portfolio-value');
            const profitElement = document.getElementById('crypto-profit-loss');
            
            // Portfolio-Gesamtwert berechnen
            let totalValue = 0;
            if (window.cryptoData.wallet.holdings && window.cryptoData.prices) {
                for (const currency in window.cryptoData.wallet.holdings) {
                    const amount = window.cryptoData.wallet.holdings[currency];
                    const price = window.cryptoData.prices[currency] || 0;
                    totalValue += amount * price;
                }
            }
            
            // Portfolio-Wert anzeigen
            if (portfolioElement) {
                portfolioElement.textContent = '$' + totalValue.toLocaleString();
            }
            
            // Gewinn/Verlust berechnen und anzeigen
            if (profitElement && window.cryptoData.wallet.totalProfit !== undefined) {
                const profit = window.cryptoData.wallet.totalProfit;
                profitElement.textContent = '$' + profit.toLocaleString();
                profitElement.style.color = profit >= 0 ? '#00FF00' : '#FF0000';
            }
        }
        
        function updateCryptoUI(cryptoData) {
            console.log('=== updateCryptoUI aufgerufen ===');
            console.log('Crypto-Daten:', cryptoData);
            
            // Crypto-Guthaben aktualisieren
            const cryptoBalanceElement = document.getElementById('crypto-balance');
            if (cryptoBalanceElement && cryptoData.balance !== undefined) {
                cryptoBalanceElement.textContent = '‚Çø ' + (cryptoData.balance || 0).toFixed(8);
                console.log('‚úÖ Crypto-Guthaben aktualisiert:', cryptoData.balance);
            }
            
            // Crypto-Preis aktualisieren
            const cryptoPriceElement = document.getElementById('crypto-price');
            if (cryptoPriceElement && cryptoData.price !== undefined) {
                cryptoPriceElement.textContent = '$' + (cryptoData.price || 0).toFixed(2);
                console.log('‚úÖ Crypto-Preis aktualisiert:', cryptoData.price);
            }
            
            // Verf√ºgbare Kryptow√§hrungen anzeigen (falls vorhanden)
            if (cryptoData.currencies) {
                updateCryptoCurrencies(cryptoData.currencies);
            }
            
            // Crypto-Transaktionen laden
            if (cryptoData.transactions) {
                loadCryptoTransactions(cryptoData.transactions);
            }
            
            // Portfolio-Wert anzeigen (falls vorhanden)
            if (cryptoData.portfolioValue !== undefined) {
                const portfolioElement = document.getElementById('crypto-portfolio-value');
                if (portfolioElement) {
                    portfolioElement.textContent = '$' + (cryptoData.portfolioValue || 0).toLocaleString();
                }
            }
            
            // Store crypto data globally for modern UI
            window.cryptoData = cryptoData;
            console.log('‚úÖ Crypto-Daten global gespeichert:', window.cryptoData);
            
            // Update portfolio data for modern UI
            if (cryptoData.wallet) {
                window.cryptoPortfolio = {
                    totalValue: cryptoData.wallet.total_invested || 0,
                    changeValue: cryptoData.wallet.total_profit || 0,
                    changePercent: cryptoData.wallet.total_profit ? (cryptoData.wallet.total_profit / cryptoData.wallet.total_invested * 100) : 0
                };
                console.log('‚úÖ Portfolio-Daten aktualisiert:', window.cryptoPortfolio);
            }
            
            // Load modern dashboard after data is updated
            setTimeout(() => {
                loadModernDashboard();
            }, 100);
        }
        
        function updateCryptoCurrencies(currencies) {
            console.log('=== updateCryptoCurrencies aufgerufen ===');
            console.log('Verf√ºgbare Kryptow√§hrungen:', currencies);
            
            // Hier k√∂nnen Sie eine Dropdown-Liste f√ºr verschiedene Kryptow√§hrungen hinzuf√ºgen
            // oder die UI entsprechend anpassen
        }
        
        function updateCryptoWallet(wallet) {
            console.log('=== updateCryptoWallet aufgerufen ===');
            console.log('Wallet:', wallet);
            
            if (wallet && wallet.holdings) {
                // Wallet-Best√§nde aktualisieren
                for (const [currency, amount] of Object.entries(wallet.holdings)) {
                    const holdingElement = document.getElementById(`crypto-holding-${currency}`);
                    if (holdingElement) {
                        holdingElement.textContent = amount.toFixed(8);
                    }
                }
                
                // Gesamtinvestition aktualisieren
                if (wallet.totalInvested !== undefined) {
                    const investedElement = document.getElementById('crypto-total-invested');
                    if (investedElement) {
                        investedElement.textContent = '$' + wallet.totalInvested.toLocaleString();
                    }
                }
                
                // Gesamtgewinn aktualisieren
                if (wallet.totalProfit !== undefined) {
                    const profitElement = document.getElementById('crypto-total-profit');
                    if (profitElement) {
                        const profit = wallet.totalProfit;
                        const color = profit >= 0 ? '#00FF00' : '#FF0000';
                        profitElement.textContent = '$' + profit.toLocaleString();
                        profitElement.style.color = color;
                    }
                }
            }
        }
        
        function updateCryptoStatus(status) {
            console.log('=== updateCryptoStatus aufgerufen ===');
            console.log('Status:', status);
            
            if (status && status.enabled !== undefined) {
                // Crypto-Status aktualisieren
                const statusElement = document.getElementById('crypto-status');
                if (statusElement) {
                    statusElement.textContent = status.enabled ? 'üü¢ Aktiv' : 'üî¥ Inaktiv';
                    statusElement.className = status.enabled ? 'crypto-status active' : 'crypto-status inactive';
                }
            }
        }
        
        function updateCryptoInfo(info) {
            console.log('=== updateCryptoInfo aufgerufen ===');
            console.log('Info:', info);
            
            if (info && info.currencies) {
                // Kryptow√§hrungs-Informationen aktualisieren
                for (const [currency, data] of Object.entries(info.currencies)) {
                    const nameElement = document.getElementById(`crypto-name-${currency}`);
                    if (nameElement) {
                        nameElement.textContent = data.name;
                    }
                    
                    const descriptionElement = document.getElementById(`crypto-description-${currency}`);
                    if (descriptionElement) {
                        descriptionElement.textContent = data.description;
                    }
                    
                    const feeElement = document.getElementById(`crypto-fee-${currency}`);
                    if (feeElement) {
                        feeElement.textContent = (data.fee * 100).toFixed(1) + '%';
                    }
                }
            }
        }
        
        function loadCryptoTransactions(transactions) {
            console.log('=== loadCryptoTransactions aufgerufen ===');
            console.log('Crypto-Transaktionen:', transactions);
            
            const cryptoTransactionsList = document.getElementById('crypto-transactions-list');
            const noCryptoTransactions = document.getElementById('no-crypto-transactions');
            
            if (!cryptoTransactionsList) {
                console.log('‚ùå Crypto-Transaktionsliste-Element nicht gefunden');
                return;
            }
            
            // Alle Transaktionen entfernen
            cryptoTransactionsList.innerHTML = '';
            
            if (!transactions || transactions.length === 0) {
                if (noCryptoTransactions) {
                    noCryptoTransactions.style.display = 'block';
                }
                console.log('‚ÑπÔ∏è Keine Crypto-Transaktionen verf√ºgbar');
                return;
            }
            
            if (noCryptoTransactions) {
                noCryptoTransactions.style.display = 'none';
            }
            
            // Crypto-Transaktionen anzeigen
            transactions.forEach((transaction, index) => {
                console.log(`Verarbeite Crypto-Transaktion ${index + 1}:`, transaction);
                
                const transactionElement = document.createElement('div');
                transactionElement.className = 'crypto-transaction-item';
                transactionElement.style.cssText = `
                    display: flex;
                    align-items: center;
                    padding: 15px;
                    margin: 10px 0;
                    background: #2a2a2a;
                    border-radius: 8px;
                    border-left: 4px solid #f7931a;
                `;
                
                const icon = transaction.type === 'buy' ? 'üí∞' : 
                            transaction.type === 'sell' ? 'üí∏' : 'üîÑ';
                
                const typeText = transaction.type === 'buy' ? 'Gekauft' : 
                                transaction.type === 'sell' ? 'Verkauft' : 'Transaktion';
                
                transactionElement.innerHTML = `
                    <div style="font-size: 24px; margin-right: 15px;">${icon}</div>
                    <div style="flex: 1;">
                        <div style="color: #ffffff; font-weight: bold; margin-bottom: 5px;">${typeText}</div>
                        <div style="color: #f7931a; font-size: 18px; margin-bottom: 5px;">‚Çø ${transaction.amount || 0}</div>
                        <div style="color: #888888; font-size: 14px;">${transaction.date || 'Unbekannt'}</div>
                    </div>
                `;
                
                cryptoTransactionsList.appendChild(transactionElement);
                console.log(`‚úÖ Crypto-Transaktion ${index + 1} hinzugef√ºgt:`, transaction);
            });
        }
        
        function buyCrypto() {
            const amountElement = document.getElementById('crypto-buy-amount');
            const currencySelect = document.getElementById('crypto-currency-select');
            
            if (!amountElement || !currencySelect) return;
            
            const amount = parseInt(amountElement.value);
            const currency = currencySelect.value;
            
            if (!amount || amount <= 0) {
                showNotification('Bitte geben Sie einen g√ºltigen Betrag ein!', 'error');
                return;
            }
            
            // Mindestbetrag pr√ºfen (aus der Config: minBuy = 10)
            if (amount < 10) {
                showNotification('Mindestbetrag: $10', 'error');
                return;
            }
            
            // Pr√ºfe ob genug Bankgeld vorhanden ist (Crypto-Addon nutzt nur Bankgeld)
            if (window.playerData && window.playerData.bank < amount) {
                showNotification('Nicht genug Geld auf dem Bankkonto!', 'error');
                return;
            }
            
            // Lade-Animation anzeigen
            showNotification('üîÑ Crypto-Kauf wird verarbeitet...', 'info');
            
            // NUI-Nachricht an Lua senden (echte Integration)
            fetch(`https://${GetParentResourceName()}/buyCrypto`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    amount: amount,
                    cryptoType: currency
                })
            }).then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message || '‚úÖ Crypto-Kauf erfolgreich!', 'success');
                    amountElement.value = '';
                    
                    // UI aktualisieren
                    setTimeout(() => {
                        loadCryptoData();
                        updateSelectedCurrencyDisplay(currency);
                    }, 500);
                } else {
                    showNotification('‚ùå Crypto-Kauf fehlgeschlagen: ' + (data.error || 'Unbekannter Fehler'), 'error');
                }
            }).catch(error => {
                console.error('‚ùå Fehler beim Crypto-Kauf:', error);
                showNotification('‚ùå Fehler beim Crypto-Kauf!', 'error');
            });
        }
        
        function sellCrypto() {
            const amountElement = document.getElementById('crypto-sell-amount');
            const currencySelect = document.getElementById('crypto-currency-select');
            
            if (!amountElement || !currencySelect) return;
            
            const amount = parseFloat(amountElement.value);
            const currency = currencySelect.value;
            
            if (!amount || amount <= 0) {
                showNotification('Bitte geben Sie einen g√ºltigen Crypto-Betrag ein!', 'error');
                return;
            }
            
            // Pr√ºfe ob genug Crypto im Wallet vorhanden ist
            if (window.cryptoData && window.cryptoData.wallet && window.cryptoData.wallet.holdings) {
                const holdings = window.cryptoData.wallet.holdings[currency] || 0;
                if (holdings < amount) {
                    showNotification('Nicht genug ' + currency + ' im Wallet!', 'error');
                    return;
                }
            }
            
            // Lade-Animation anzeigen
            showNotification('üîÑ Crypto-Verkauf wird verarbeitet...', 'info');
            
            // NUI-Nachricht an Lua senden (echte Integration)
            fetch(`https://${GetParentResourceName()}/sellCrypto`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    amount: amount,
                    cryptoType: currency
                })
            }).then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message || '‚úÖ Crypto-Verkauf erfolgreich!', 'success');
                    amountElement.value = '';
                    
                    // UI aktualisieren
                    setTimeout(() => {
                        loadCryptoData();
                        updateSelectedCurrencyDisplay(currency);
                    }, 500);
                } else {
                    showNotification('‚ùå Crypto-Verkauf fehlgeschlagen: ' + (data.error || 'Unbekannter Fehler'), 'error');
                }
            }).catch(error => {
                console.error('‚ùå Fehler beim Crypto-Verkauf:', error);
                showNotification('‚ùå Fehler beim Crypto-Verkauf!', 'error');
            });
        }
        
        // Event-Listener f√ºr automatische Berechnungen hinzuf√ºgen
        document.addEventListener('DOMContentLoaded', function() {
            // Event-Listener f√ºr Kauf-Betrag
            const buyAmountInput = document.getElementById('crypto-buy-amount');
            if (buyAmountInput) {
                buyAmountInput.addEventListener('input', updateCryptoBuyCalculation);
            }
            
            // Event-Listener f√ºr Verkauf-Betrag
            const sellAmountInput = document.getElementById('crypto-sell-amount');
            if (sellAmountInput) {
                sellAmountInput.addEventListener('input', updateCryptoSellCalculation);
            }
            
            // Event-Listener f√ºr W√§hrungsauswahl
            const currencySelect = document.getElementById('crypto-currency-select');
            if (currencySelect) {
                currencySelect.addEventListener('change', function() {
                    updateCryptoSelection();
                });
            }
        });
        
        // Hilfsfunktion f√ºr Benachrichtigungen
        function showNotification(message, type = 'info') {
            console.log(`[ZS Banking ${type.toUpperCase()}] ${message}`);
            
            // Bestehende Notifications entfernen
            const existingNotifications = document.querySelectorAll('.zs-notification');
            existingNotifications.forEach(notification => {
                if (notification.parentElement) {
                    notification.remove();
                }
            });
            
            // Neue Notification erstellen
            const notification = document.createElement('div');
            notification.className = `zs-notification zs-notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : type === 'warning' ? '#ff9800' : '#2196F3'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 400px;
                word-wrap: break-word;
                animation: slideInRight 0.3s ease-out;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-weight: 500;
            `;
            
            // Icon basierend auf Typ
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 18px;">${icon}</span>
                    <span>${message}</span>
                </div>
            `;
            
            // CSS Animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInRight {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOutRight {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Automatisch ausblenden nach 5 Sekunden
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 5000);
            
            // Klick zum Schlie√üen
            notification.addEventListener('click', () => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            });
        }
        


        





        
        // ========================================
        // ERWEITERTE CRYPTO-FUNKTIONEN
        // ========================================
        
        // Globale Variablen f√ºr erweiterte Features
        let currentCryptoSection = 'overview';
        let currentOrderType = 'market';
        
        // Crypto Section Navigation (Global verf√ºgbar)
        window.showCryptoSection = function(sectionName) {
            // Alle Sektionen verstecken
            const sections = document.querySelectorAll('.crypto-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Alle Nav-Buttons deaktivieren
            const navBtns = document.querySelectorAll('.crypto-nav-btn');
            navBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Gew√ºnschte Sektion anzeigen
            const targetSection = document.getElementById('crypto-' + sectionName);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Nav-Button aktivieren
            const activeBtn = document.querySelector(`[onclick="showCryptoSection('${sectionName}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            currentCryptoSection = sectionName;
            
            // Sektions-spezifische Initialisierung
            switch(sectionName) {
                case 'overview':
                    loadCryptoOverview();
                    break;
                case 'trading':
                    updateCryptoSelection();
                    break;
                case 'charts':
                    loadCryptoCharts();
                    break;
                case 'portfolio':
                    loadPortfolioAnalysis();
                    break;
                case 'staking':
                    loadStakingData();
                    break;
                case 'contests':
                    loadContestsData();
                    break;
                case 'insights':
                    loadMarketInsights();
                    break;
            }
        }
        
        // Order Type Management (Global verf√ºgbar)
        window.setOrderType = function(type) {
            const buttons = document.querySelectorAll('.order-type-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            const activeBtn = document.querySelector(`[onclick="setOrderType('${type}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
            
            currentOrderType = type;
            updateOrderForm();
        }
        
        function updateOrderForm() {
            const orderForm = document.getElementById('order-form');
            if (!orderForm) return;
            
            let formContent = '';
            
            switch(currentOrderType) {
                case 'market':
                    formContent = `<div style="color: #888; padding: 10px;">Market Order - Sofortige Ausf√ºhrung zum aktuellen Marktpreis</div>`;
                    break;
                case 'limit':
                    formContent = `<div><label>Limit-Preis:</label><input type="number" id="limit-price" placeholder="Gew√ºnschter Preis" step="0.01"></div>`;
                    break;
                case 'stop':
                    formContent = `<div><label>Stop-Loss Preis:</label><input type="number" id="stop-price" placeholder="Stop-Preis" step="0.01"></div>`;
                    break;
            }
            
            orderForm.innerHTML = formContent;
        }
        
        // Crypto Overview Funktionen
        function loadCryptoOverview() {
            updateMarketOverview();
            updateQuickStats();
        }
        
        function updateMarketOverview() {
            const marketGrid = document.getElementById('crypto-market-grid');
            if (!marketGrid || !window.cryptoData) return;
            
            let gridContent = '';
            
            for (const [currency, data] of Object.entries(window.cryptoData.currencies || {})) {
                const price = window.cryptoData.prices ? window.cryptoData.prices[currency] : data.basePrice;
                const change = Math.random() * 10 - 5; // Simulation
                const changeClass = change >= 0 ? 'positive' : 'negative';
                const changeIcon = change >= 0 ? 'üìà' : 'üìâ';
                
                // Generiere Mini-Chart Daten (24h Simulation)
                const chartData = generateMiniChartData(currency, change);
                const miniChart = generateMiniChart(chartData, changeClass);
                
                gridContent += `
                    <div class="market-card" data-currency="${currency}">
                        <div class="market-card-info">
                            <h5>${data.name}</h5>
                            <div style="font-size: 12px; color: #888;">${currency}</div>
                            <div class="price-change ${changeClass}">
                                ${changeIcon} ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
                            </div>
                        </div>
                        <div class="market-card-price">
                            <div class="current-price">$${parseFloat(price).toFixed(2)}</div>
                            <div class="mini-chart-container">
                                ${miniChart}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            marketGrid.innerHTML = gridContent;
        }
        
        // Funktion zum Generieren von Mini-Chart Daten
        function generateMiniChartData(currency, trendDirection) {
            const points = 24; // 24 Stunden
            const data = [];
            let currentValue = 100;
            
            for (let i = 0; i < points; i++) {
                // Simuliere realistisches Preisverhalten
                const volatility = 0.02; // 2% Volatilit√§t
                const trend = trendDirection > 0 ? 0.001 : -0.001; // Leichter Trend
                const randomChange = (Math.random() - 0.5) * volatility;
                
                currentValue = currentValue * (1 + trend + randomChange);
                data.push(currentValue);
            }
            
            return data;
        }
        
        // Funktion zum Generieren eines SVG Mini-Charts
        function generateMiniChart(data, trendClass) {
            if (!data || data.length === 0) return '<div style="color: #666;">üìä</div>';
            
            const width = 60;
            const height = 30;
            const padding = 2;
            
            const minVal = Math.min(...data);
            const maxVal = Math.max(...data);
            const range = maxVal - minVal || 1;
            
            // Generiere SVG-Pfad
            let pathData = '';
            
            for (let i = 0; i < data.length; i++) {
                const x = padding + ((width - 2 * padding) * i) / (data.length - 1);
                const y = height - padding - ((height - 2 * padding) * (data[i] - minVal)) / range;
                
                if (i === 0) {
                    pathData += `M ${x} ${y}`;
                } else {
                    pathData += ` L ${x} ${y}`;
                }
            }
            
            const strokeColor = trendClass === 'positive' ? '#4CAF50' : '#f44336';
            const fillColor = trendClass === 'positive' ? 'rgba(76, 175, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)';
            
            // F√ºge F√ºllfl√§che hinzu
            const fillPath = pathData + ` L ${width - padding} ${height - padding} L ${padding} ${height - padding} Z`;
            
            return `
                <svg width="${width}" height="${height}" class="mini-chart">
                    <defs>
                        <linearGradient id="gradient-${trendClass}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${strokeColor};stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:${strokeColor};stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    <path d="${fillPath}" fill="url(#gradient-${trendClass})" />
                    <path d="${pathData}" stroke="${strokeColor}" stroke-width="1.5" fill="none" />
                </svg>
            `;
        }
        
        function updateQuickStats() {
            const totalInvested = document.getElementById('total-invested');
            const bestPerformer = document.getElementById('best-performer');
            const totalTrades = document.getElementById('total-trades');
            
            if (window.cryptoData && window.cryptoData.wallet) {
                if (totalInvested) totalInvested.textContent = `$${(window.cryptoData.wallet.totalInvested || 0).toFixed(2)}`;
                if (totalTrades) totalTrades.textContent = '0';
            }
            
            if (bestPerformer) bestPerformer.textContent = 'BTC (+12.5%)';
        }
        
        // Charts Funktionen
        function loadCryptoCharts() {
            const currency = document.getElementById('chart-currency')?.value || 'BTC';
            const timeframe = document.getElementById('chart-timeframe')?.value || '1d';
            const chartType = document.getElementById('chart-type')?.value || 'line';
            
            const chartContainer = document.getElementById('crypto-chart-container');
            if (!chartContainer) return;
            
            chartContainer.innerHTML = `
                <div style="text-align: center; color: #888;">
                    <i class="fas fa-chart-line" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <h4>${currency} ${chartType.toUpperCase()} Chart (${timeframe})</h4>
                    <p>Chart wird geladen...</p>
                </div>
            `;
            
            // Technische Indikatoren aktualisieren
            const rsiValue = document.getElementById('rsi-value');
            const macdValue = document.getElementById('macd-value');
            const maValue = document.getElementById('ma-value');
            
            if (rsiValue) rsiValue.textContent = '45.2';
            if (macdValue) macdValue.textContent = '0.023';
            if (maValue) maValue.textContent = '$' + (Math.random() * 10000 + 40000).toFixed(2);
        }
        
        // Portfolio Analysis Funktionen
        function loadPortfolioAnalysis() {
            updatePortfolioAllocation();
            updatePerformanceMetrics();
            updateHoldingsTable();
        }
        
        function updatePortfolioAllocation() {
            const pieChart = document.getElementById('portfolio-pie-chart');
            if (!pieChart) return;
            
            pieChart.innerHTML = `
                <div style="text-align: center;">
                    <i class="fas fa-chart-pie" style="font-size: 48px; margin-bottom: 15px;"></i>
                    <h5>Portfolio-Verteilung</h5>
                    <p>Chart wird geladen...</p>
                </div>
            `;
        }
        
        function updatePerformanceMetrics() {
            const metrics = {
                'sharpe-ratio': '1.42',
                'max-drawdown': '-8.3%',
                'volatility': '15.2%',
                'beta': '0.89'
            };
            
            for (const [id, value] of Object.entries(metrics)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
        }
        
        function updateHoldingsTable() {
            const holdingsTable = document.getElementById('holdings-table');
            if (!holdingsTable || !window.cryptoData) return;
            
            let tableContent = `
                <div class="holdings-row holdings-header">
                    <div>Asset</div>
                    <div>Name</div>
                    <div>Menge</div>
                    <div>Wert</div>
                    <div>√Ñnderung</div>
                </div>
            `;
            
            if (window.cryptoData.wallet && window.cryptoData.wallet.holdings) {
                for (const [currency, amount] of Object.entries(window.cryptoData.wallet.holdings)) {
                    if (amount > 0) {
                        const currencyData = window.cryptoData.currencies[currency];
                        const price = window.cryptoData.prices[currency] || currencyData?.basePrice || 0;
                        const value = amount * price;
                        const change = Math.random() * 10 - 5;
                        const changeClass = change >= 0 ? 'positive' : 'negative';
                        
                        tableContent += `
                            <div class="holdings-row">
                                <div><strong>${currency}</strong></div>
                                <div>${currencyData?.name || currency}</div>
                                <div>${parseFloat(amount).toFixed(8)}</div>
                                <div>$${value.toFixed(2)}</div>
                                <div class="price-change ${changeClass}">
                                    ${change >= 0 ? '+' : ''}${change.toFixed(2)}%
                                </div>
                            </div>
                        `;
                    }
                }
            }
            
            if (!window.cryptoData.wallet?.holdings || Object.keys(window.cryptoData.wallet.holdings).length === 0) {
                tableContent += `
                    <div style="text-align: center; padding: 20px; color: #888;">
                        <i class="fas fa-wallet"></i><br>
                        Keine Crypto-Best√§nde vorhanden
                    </div>
                `;
            }
            
            holdingsTable.innerHTML = tableContent;
        }
        
        // Staking Funktionen
        function loadStakingData() {
            const totalStaked = document.getElementById('total-staked');
            const totalRewards = document.getElementById('total-rewards');
            const averageApy = document.getElementById('average-apy');
            
            if (totalStaked) totalStaked.textContent = '$0.00';
            if (totalRewards) totalRewards.textContent = '$0.00';
            if (averageApy) averageApy.textContent = '5.2%';
            
            const poolsList = document.getElementById('staking-pools-list');
            if (poolsList) {
                poolsList.innerHTML = `
                    <div class="staking-pool">
                        <div>
                            <h5>ETH Staking</h5>
                            <div style="font-size: 12px; color: #888;">Min: 0.1 ETH</div>
                        </div>
                        <div style="text-align: right;">
                            <div><strong>5.2% APY</strong></div>
                            <button onclick="startStaking('ETH')" 
                                    style="background: #4CAF50; border: none; padding: 5px 10px; border-radius: 4px; color: white; cursor: pointer;">
                                Staken
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        window.startStaking = function(currency) {
            showNotification(`Staking f√ºr ${currency} wird implementiert...`, 'info');
        }
        
        // Contests Funktionen
        function loadContestsData() {
            const contestsList = document.getElementById('active-contests-list');
            if (contestsList) {
                contestsList.innerHTML = `
                    <div class="contest-card">
                        <h5>üìà W√∂chlicher Trading Contest</h5>
                        <p>Preispool: $5,000 | Teilnehmer: 47/100</p>
                        <p>Endet in: 3 Tage 12 Stunden</p>
                        <button onclick="joinContest('weekly')" 
                                style="background: #4CAF50; border: none; padding: 8px 15px; border-radius: 4px; color: white; cursor: pointer;">
                            Teilnehmen
                        </button>
                    </div>
                `;
            }
            
            const leaderboard = document.getElementById('contest-leaderboard');
            if (leaderboard) {
                leaderboard.innerHTML = `
                    <div class="leaderboard-entry holdings-header">
                        <div>Rang</div>
                        <div>Spieler</div>
                        <div>Gewinn</div>
                        <div>ROI</div>
                    </div>
                    <div class="leaderboard-entry">
                        <div><strong>#1</strong></div>
                        <div>CryptoKing</div>
                        <div class="price-change positive">+23.5%</div>
                        <div>$2,350</div>
                    </div>
                `;
            }
        }
        
        window.joinContest = function(contestType) {
            showNotification(`Anmeldung f√ºr ${contestType} Contest wird verarbeitet...`, 'info');
        }
        
        // Market Insights Funktionen
        function loadMarketInsights() {
            const insightsList = document.getElementById('market-insights-list');
            if (insightsList) {
                insightsList.innerHTML = `
                    <div class="insight-item info">
                        <i class="fas fa-lightbulb"></i> Bitcoin zeigt starke Aufw√§rtsdynamik mit erh√∂htem Volumen.
                    </div>
                    <div class="insight-item warning">
                        <i class="fas fa-exclamation-triangle"></i> Ethereum n√§hert sich einem wichtigen Widerstandslevel.
                    </div>
                `;
            }
            
            const predictions = document.getElementById('price-predictions');
            if (predictions) {
                predictions.innerHTML = `
                    <div class="prediction-item">
                        <div>
                            <strong>BTC</strong> - KI-Analyse<br>
                            <span style="font-size: 12px; color: #888;">Konfidenz: 78%</span>
                        </div>
                        <div style="text-align: right;">
                            <strong>$52,000</strong><br>
                            <span style="font-size: 12px; color: #4CAF50;">üìà Bullish</span>
                        </div>
                    </div>
                `;
            }
        }
        
        window.createPriceAlert = function() {
            const currency = document.getElementById('alert-currency')?.value;
            const type = document.getElementById('alert-type')?.value;
            const value = document.getElementById('alert-value')?.value;
            
            if (!currency || !type || !value) {
                showNotification('Bitte alle Felder ausf√ºllen', 'error');
                return;
            }
            
            showNotification(`Preisalarm f√ºr ${currency} (${type} ${value}) erstellt`, 'success');
            document.getElementById('alert-value').value = '';
        }
        
        // Event Listeners f√ºr erweiterte Features
        document.addEventListener('DOMContentLoaded', function() {
            const chartCurrency = document.getElementById('chart-currency');
            const chartTimeframe = document.getElementById('chart-timeframe');
            const chartType = document.getElementById('chart-type');
            
            if (chartCurrency) chartCurrency.addEventListener('change', () => loadCryptoCharts());
            if (chartTimeframe) chartTimeframe.addEventListener('change', () => loadCryptoCharts());
            if (chartType) chartType.addEventListener('change', () => loadCryptoCharts());
            
            // Order Type initialisieren
            setOrderType('market');
        });
        
        console.log('üöÄ Erweiterte Crypto-Features geladen');
        
        // ========================================
        // MODERNE CRYPTO-UI FUNKTIONEN
        // ========================================
        
        // Enhanced showCryptoSection with better navigation
        const originalShowCryptoSection = window.showCryptoSection;
        window.showCryptoSection = function(section) {
            console.log('=== Modern showCryptoSection aufgerufen ===');
            console.log('Section:', section);
            
            // Call original function if it exists, otherwise use new logic
            if (originalShowCryptoSection && typeof originalShowCryptoSection === 'function') {
                originalShowCryptoSection(section);
            } else {
                // New logic for showing sections
                document.querySelectorAll('.crypto-section').forEach(sec => {
                    sec.style.display = 'none';
                    sec.classList.remove('active');
                });
                
                document.querySelectorAll('.crypto-nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const selectedSection = document.getElementById(`crypto-${section}`);
                if (selectedSection) {
                    selectedSection.style.display = 'block';
                    selectedSection.classList.add('active');
                }
                
                const activeBtn = document.querySelector(`.crypto-nav-btn[onclick*="${section}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
            
            // Load section-specific data
            switch(section) {
                case 'overview':
                    loadModernDashboard();
                    break;
                case 'trading':
                    loadModernTradingInterface();
                    break;
                case 'charts':
                    loadModernChartInterface();
                    break;
                case 'portfolio':
                    loadModernPortfolioData();
                    break;
            }
        };
        
        // Quick action handler for dashboard buttons
        window.quickAction = function(action) {
            console.log('Quick action triggered:', action);
            switch(action) {
                case 'buy':
                    showCryptoSection('trading');
                    setTimeout(() => {
                        const buyAmountInput = document.getElementById('crypto-buy-amount');
                        if (buyAmountInput) {
                            buyAmountInput.focus();
                            buyAmountInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 300);
                    break;
                case 'sell':
                    showCryptoSection('trading');
                    setTimeout(() => {
                        const sellAmountInput = document.getElementById('crypto-sell-amount');
                        if (sellAmountInput) {
                            sellAmountInput.focus();
                            sellAmountInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    }, 300);
                    break;
                default:
                    console.log('Unknown quick action:', action);
            }
        };
        
        // Enhanced refresh market data with animation
        window.refreshMarketData = function() {
            console.log('üîÑ Refreshing market data...');
            const refreshBtn = document.querySelector('.refresh-btn i');
            
            if (refreshBtn) {
                // Add rotation animation
                refreshBtn.style.animation = 'spin 1s linear';
                setTimeout(() => {
                    refreshBtn.style.animation = '';
                }, 1000);
            }
            
            // Update market time
            const marketTime = document.getElementById('market-time');
            if (marketTime) {
                const now = new Date();
                marketTime.textContent = `Last update: ${now.toLocaleTimeString('de-DE')}`;
            }
            
            // Reload crypto data if addon is available
            if (window.cryptoAddonAvailable) {
                loadCryptoData();
                loadEnhancedMarketOverview();
            }
            
            showNotification('Marktdaten aktualisiert', 'success');
        };
        
        // Load modern dashboard (Performance-optimiert)
        function loadModernDashboard() {
            console.log('üìä Loading modern dashboard...');
            
            // Batch Updates f√ºr bessere Performance
            requestAnimationFrame(() => {
                updateModernPortfolioSummary();
                loadEnhancedMarketOverview();
                updateModernPerformanceStats();
            });
        }
        
        // Update portfolio summary with enhanced design (Performance-optimiert)
        function updateModernPortfolioSummary() {
            // Portfolio value with smooth animations (reduzierte Dauer f√ºr bessere Performance)
            const portfolioValue = document.getElementById('crypto-portfolio-value');
            const portfolioChange = document.getElementById('portfolio-change');
            
            if (portfolioValue) {
                // Animate counter (reduzierte Dauer: 1000ms -> 500ms)
                animateValue(portfolioValue, 0, window.cryptoPortfolio?.totalValue || 0, 500, true);
            }
            
            if (portfolioChange) {
                const changeValue = window.cryptoPortfolio?.changeValue || 0;
                const changePercent = window.cryptoPortfolio?.changePercent || 0;
                
                const changeValueSpan = portfolioChange.querySelector('.change-value');
                const changePercentSpan = portfolioChange.querySelector('.change-percent');
                
                if (changeValueSpan && changePercentSpan) {
                    const sign = changeValue >= 0 ? '+' : '';
                    changeValueSpan.textContent = `${sign}$${Math.abs(changeValue).toLocaleString('de-DE', {minimumFractionDigits: 2})}`;
                    changePercentSpan.textContent = `(${sign}${Math.abs(changePercent).toFixed(2)}%)`;
                    
                    // Color coding
                    changeValueSpan.style.color = changeValue >= 0 ? '#4CAF50' : '#f44336';
                    changePercentSpan.style.color = changeValue >= 0 ? '#4CAF50' : '#f44336';
                }
            }
            
            // Available cash
            const availableCash = document.getElementById('available-cash');
            if (availableCash && window.playerData) {
                const bankMoney = window.playerData.bank || 0;
                animateValue(availableCash, 0, bankMoney, 400, true); // Reduziert: 800ms -> 400ms
            }
            
            // Update trades today
            const totalTrades = document.getElementById('total-trades');
            const todaysVolume = document.getElementById('todays-volume');
            
            if (totalTrades) {
                animateValue(totalTrades, 0, 0, 300, false); // Reduziert: 600ms -> 300ms, Wert: 0
            }
            
            if (todaysVolume) {
                animateValue(todaysVolume, 0, 0, 350, true); // Reduziert: 700ms -> 350ms, Wert: 0
            }
        }
        
        // Enhanced market overview with REAL crypto data (Performance-optimiert)
        function loadEnhancedMarketOverview() {
            console.log('üåç Loading enhanced market overview...');
            const marketGrid = document.getElementById('crypto-market-grid');
            if (!marketGrid) return;
            
            // Sofort aktuelle Preise vom Server anfordern
            if (window.invokeNative) {
                console.log('üì° Fordere aktuelle Crypto-Daten an...');
                window.invokeNative('getCryptoData', {});
                
                // Warte kurz und pr√ºfe dann die Daten
                setTimeout(() => {
                    if (window.cryptoData && window.cryptoData.prices && window.cryptoData.currencies) {
                        console.log('‚úÖ Crypto-Daten geladen:', window.cryptoData);
                        displayRealCryptoData(window.cryptoData);
                    } else {
                        console.log('‚ùå Keine Crypto-Daten verf√ºgbar, verwende Fallback');
                        displayBasicCryptoInfo();
                    }
                }, 500);
            } else {
                console.log('‚ùå NUI nicht verf√ºgbar, verwende Fallback');
                displayBasicCryptoInfo();
            }
        }
        
        // Display real crypto data from server
        function displayRealCryptoData(cryptoData) {
            const marketGrid = document.getElementById('crypto-market-grid');
            if (!marketGrid) return;
            
            const cryptos = [];
            
            // Convert real data to display format
            if (cryptoData.prices && cryptoData.currencies) {
                for (const [symbol, price] of Object.entries(cryptoData.prices)) {
                    const currencyInfo = cryptoData.currencies[symbol];
                    if (currencyInfo) {
                        // Calculate 24h change based on base price and current price
                        const basePrice = currencyInfo.basePrice || price;
                        const change = ((price - basePrice) / basePrice) * 100;
                        
                        cryptos.push({
                            symbol: symbol,
                            name: currencyInfo.name,
                            price: price,
                            change: change,
                            volume: currencyInfo.volume24h ? `$${(currencyInfo.volume24h / 1000000).toFixed(1)}M` : 'Live',
                            marketCap: currencyInfo.marketCap ? `$${(currencyInfo.marketCap / 1000000000).toFixed(1)}B` : 'Real-time',
                            icon: currencyInfo.icon || 'fas fa-coins',
                            color: currencyInfo.color || '#627EEA',
                            description: currencyInfo.description || ''
                        });
                    }
                }
            }
            
            if (cryptos.length === 0) {
                displayBasicCryptoInfo();
                return;
            }
            
            console.log('üìä Displaying crypto data:', cryptos);
            
            // Fade out old content
            marketGrid.style.opacity = '0.5';
            
            setTimeout(() => {
                marketGrid.innerHTML = '';
                
                cryptos.forEach((crypto, index) => {
                    setTimeout(() => {
                        const card = createEnhancedMarketCard(crypto);
                        marketGrid.appendChild(card);
                        
                        // Animate card appearance
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(20px)';
                        
                        setTimeout(() => {
                            card.style.transition = 'all 0.3s ease';
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, 50);
                    }, index * 100);
                });
                
                marketGrid.style.opacity = '1';
            }, 200);
        }
        
        // Create enhanced market card with better design
        function createEnhancedMarketCard(crypto) {
            const card = document.createElement('div');
            card.className = 'market-card';
            card.innerHTML = `
                <div class="market-card-header">
                    <div class="crypto-logo">${getCryptoIcon(crypto.symbol)}</div>
                    <div class="market-card-info">
                        <h4>${crypto.name}</h4>
                        <div class="market-card-symbol">${crypto.symbol}/USD</div>
                    </div>
                </div>
                
                <div class="market-card-price">
                    <div class="current-price">$${formatPrice(crypto.price)}</div>
                    <div class="price-change ${crypto.change >= 0 ? 'positive' : 'negative'}">
                        ${crypto.change >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(crypto.change).toFixed(2)}%
                    </div>
                </div>
                
                <div class="mini-chart-container">
                    <svg class="mini-chart" viewBox="0 0 300 60">
                        ${generateEnhancedMiniChart(crypto)}
                    </svg>
                </div>
                
                <div class="market-card-stats">
                    <div class="stat-item">
                        <span>24h Vol</span>
                        <span class="stat-value">$${crypto.volume}</span>
                    </div>
                    <div class="stat-item">
                        <span>Market Cap</span>
                        <span class="stat-value">$${crypto.marketCap}</span>
                    </div>
                </div>
            `;
            
            // Enhanced click handler
            card.addEventListener('click', () => {
                selectCryptoForTrading(crypto.symbol);
                showCryptoSection('trading');
                showNotification(`${crypto.name} f√ºr Trading ausgew√§hlt`, 'info');
            });
            
            // Hover effects
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'translateY(-4px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'translateY(0) scale(1)';
            });
            
            return card;
        }
        
        // Get crypto icon
        function getCryptoIcon(symbol) {
            const icons = {
                'BTC': '‚Çø',
                'ETH': 'Œû',
                'ADA': '‚Ç≥',
                'XRP': '‚óâ',
                'DOT': '‚óè'
            };
            return icons[symbol] || symbol.charAt(0);
        }
        
        // Format price based on value
        function formatPrice(price) {
            if (price >= 1000) {
                return price.toLocaleString('de-DE', {minimumFractionDigits: 0, maximumFractionDigits: 0});
            } else if (price >= 1) {
                return price.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            } else {
                return price.toLocaleString('de-DE', {minimumFractionDigits: 3, maximumFractionDigits: 6});
            }
        }
        
        // Generate enhanced mini chart with better visuals
        function generateEnhancedMiniChart(crypto) {
            const points = [];
            let basePrice = crypto.price;
            const trend = crypto.change / 100; // Convert percentage to decimal
            
            // Generate 24 hours of data
            for (let i = 0; i < 24; i++) {
                const hourlyVariation = (Math.random() - 0.5) * 0.02; // ¬±1% hourly variation
                const trendEffect = trend * (i / 24); // Gradual trend over 24h
                basePrice *= (1 + hourlyVariation + trendEffect / 24);
                points.push(basePrice);
            }
            
            // Normalize points to chart dimensions
            const minPrice = Math.min(...points);
            const maxPrice = Math.max(...points);
            const priceRange = maxPrice - minPrice || 1;
            
            const chartPoints = points.map((price, index) => {
                const x = (index / (points.length - 1)) * 280 + 10;
                const y = 50 - ((price - minPrice) / priceRange) * 40 + 5;
                return `${x},${y}`;
            }).join(' ');
            
            // Color based on overall trend
            const isPositive = crypto.change >= 0;
            const strokeColor = isPositive ? '#4CAF50' : '#f44336';
            const glowColor = isPositive ? 'rgba(76, 175, 80, 0.6)' : 'rgba(244, 67, 54, 0.6)';
            
            return `
                <defs>
                    <linearGradient id="gradient-${crypto.symbol}" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:${strokeColor};stop-opacity:0.4" />
                        <stop offset="100%" style="stop-color:${strokeColor};stop-opacity:0.05" />
                    </linearGradient>
                    <filter id="glow-${crypto.symbol}">
                        <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                        <feMerge> 
                            <feMergeNode in="coloredBlur"/>
                            <feMergeNode in="SourceGraphic"/>
                        </feMerge>
                    </filter>
                </defs>
                <polyline
                    points="${chartPoints} 290,55 10,55"
                    fill="url(#gradient-${crypto.symbol})"
                    stroke="none"
                />
                <polyline
                    points="${chartPoints}"
                    fill="none"
                    stroke="${strokeColor}"
                    stroke-width="2"
                    filter="url(#glow-${crypto.symbol})"
                />
            `;
        }
        
        // Animate value function
        function animateValue(element, start, end, duration, isCurrency = false) {
            if (!element) return;
            
            const range = end - start;
            const increment = range / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                
                if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                    current = end;
                    clearInterval(timer);
                }
                
                if (isCurrency) {
                    element.textContent = `$${current.toLocaleString('de-DE', {minimumFractionDigits: 2})}`;
                } else {
                    element.textContent = Math.floor(current).toString();
                }
            }, 16);
        }
        
        // Update modern performance stats
        function updateModernPerformanceStats() {
            const stats = {
                totalInvested: 1150.00,
                bestPerformer: 'ADA (+5.67%)',
                totalROI: 8.75,
                lastTrade: 'vor 2h'
            };
            
            // Animate stats updates
            setTimeout(() => updateStatElement('total-invested', `$${stats.totalInvested.toLocaleString('de-DE')}`), 200);
            setTimeout(() => updateStatElement('best-performer', stats.bestPerformer), 400);
            setTimeout(() => updateStatElement('total-roi', `+${stats.totalROI}%`), 600);
            setTimeout(() => updateStatElement('last-trade', stats.lastTrade), 800);
        }
        
        function updateStatElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.style.opacity = '0.5';
                setTimeout(() => {
                    element.textContent = value;
                    element.style.opacity = '1';
                }, 150);
            }
        }
        
        // Load modern trading interface
        function loadModernTradingInterface() {
            console.log('üíπ Loading modern trading interface...');
            updateCryptoSelection();
        }
        
        // Load modern chart interface
        function loadModernChartInterface() {
            console.log('üìà Loading modern chart interface...');
            loadCryptoCharts();
        }
        
        // Load modern portfolio data
        function loadModernPortfolioData() {
            console.log('üíº Loading modern portfolio data...');
            loadPortfolioAnalysis();
        }
        
        // Select crypto for trading with enhanced feedback
        function selectCryptoForTrading(symbol) {
            const cryptoSelect = document.getElementById('crypto-currency-select');
            if (cryptoSelect) {
                cryptoSelect.value = symbol;
                updateCryptoSelection();
                
                // Add visual feedback
                cryptoSelect.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    cryptoSelect.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        console.log('üé® Moderne Crypto-UI erfolgreich geladen');
        
        // ========================================
        // AUTO-INITIALIZATION
        // ========================================
        
        // Auto-load modern dashboard when crypto tab is opened (Performance-optimiert)
        document.addEventListener('DOMContentLoaded', function() {
            // Crypto-Tab nur anzeigen wenn in Config aktiviert
            const cryptoTabBtn = document.getElementById('crypto-tab-btn');
            if (cryptoTabBtn) {
                // Pr√ºfe Config-Einstellung
                if (window.cryptoAddonAvailable && window.cryptoAddonAvailable === true) {
                    cryptoTabBtn.style.display = 'block';
                    cryptoTabBtn.addEventListener('click', function() {
                        // Sofort laden ohne Verz√∂gerung f√ºr bessere Performance
                        requestAnimationFrame(() => {
                            loadModernDashboard();
                        });
                    });
                } else {
                    cryptoTabBtn.style.display = 'none';
                    console.log('‚ùå Crypto-Tab versteckt (Config: false)');
                }
            }
            
            // Initialize modern features immediately if crypto section is already visible
            const cryptoSection = document.getElementById('crypto');
            if (cryptoSection && cryptoSection.style.display !== 'none') {
                // Reduzierte Verz√∂gerung f√ºr bessere Performance
                requestAnimationFrame(() => {
                    loadModernDashboard();
                });
            }
        });
        
        // Enhanced localization support for new UI elements
        const modernCryptoLocales = {
            de: {
                // Dashboard
                'portfolio_value': 'Portfolio Wert',
                'available_trading': 'Verf√ºgbar zum Trading',
                'daily_pnl': '24h Gewinn/Verlust',
                'trades_today': 'Trades Heute',
                'market_overview': 'Markt√ºbersicht',
                'quick_actions': 'Schnellaktionen',
                'performance': 'Performance',
                'last_update': 'Letzte Aktualisierung',
                'live_market': 'Live Markt',
                'trading_volume': 'Handelsvolumen',
                'market_cap': 'Marktkapitalisierung',
                'roi_total': 'ROI Gesamt',
                'last_trade': 'Letzter Trade',
                'best_performer': 'Top Performer',
                'total_invested': 'Investiert Gesamt',
                
                // Actions
                'instant_buy': 'Sofort Kaufen',
                'instant_sell': 'Sofort Verkaufen',
                'portfolio_analysis': 'Portfolio Analyse',
                'technical_analysis': 'Technische Analyse',
                'market_order': 'Market Order',
                'refresh_data': 'Daten aktualisieren',
                
                // Status
                'online': 'Online',
                'loading': 'L√§dt...',
                'updated': 'Aktualisiert',
                'selected_for_trading': 'f√ºr Trading ausgew√§hlt',
                'data_refreshed': 'Daten aktualisiert'
            },
            en: {
                // Dashboard
                'portfolio_value': 'Portfolio Value',
                'available_trading': 'Available for Trading',
                'daily_pnl': '24h P&L',
                'trades_today': 'Trades Today',
                'market_overview': 'Market Overview',
                'quick_actions': 'Quick Actions',
                'performance': 'Performance',
                'last_update': 'Last Update',
                'live_market': 'Live Market',
                'trading_volume': 'Trading Volume',
                'market_cap': 'Market Cap',
                'roi_total': 'Total ROI',
                'last_trade': 'Last Trade',
                'best_performer': 'Best Performer',
                'total_invested': 'Total Invested',
                
                // Actions
                'instant_buy': 'Instant Buy',
                'instant_sell': 'Instant Sell',
                'portfolio_analysis': 'Portfolio Analysis',
                'technical_analysis': 'Technical Analysis',
                'market_order': 'Market Order',
                'refresh_data': 'Refresh Data',
                
                // Status
                'online': 'Online',
                'loading': 'Loading...',
                'updated': 'Updated',
                'selected_for_trading': 'selected for trading',
                'data_refreshed': 'Data refreshed'
            }
        };
        
        // Apply modern localization
        function applyModernLocalization(lang = 'de') {
            const locale = modernCryptoLocales[lang] || modernCryptoLocales.de;
            
            // Update card titles and labels dynamically
            document.querySelectorAll('[data-modern-translate]').forEach(element => {
                const key = element.getAttribute('data-modern-translate');
                if (locale[key]) {
                    element.textContent = locale[key];
                }
            });
        }
        
        // Export functions for external use
        window.modernCrypto = {
            loadDashboard: loadModernDashboard,
            refreshMarketData: refreshMarketData,
            quickAction: quickAction,
            selectCrypto: selectCryptoForTrading,
            applyLocalization: applyModernLocalization
        };
        
        // Hilfsfunktionen f√ºr echte Crypto-Daten
        function calculatePriceChange(symbol, currentPrice) {
            // Simuliere √Ñnderung basierend auf vorherigem Preis (in echtem System aus Historie)
            const baseChanges = { 'BTC': 2.1, 'ETH': -1.5, 'ADA': 4.2, 'XRP': -0.8, 'DOT': 3.1 };
            return baseChanges[symbol] || (Math.random() - 0.5) * 10;
        }
        
        function displayBasicCryptoInfo() {
            const marketGrid = document.getElementById('crypto-market-grid');
            if (!marketGrid) return;
            
            marketGrid.innerHTML = `
                <div class="crypto-loading">
                    <i class="fas fa-coins fa-spin"></i>
                    <p>Lade Crypto-Daten...</p>
                    <small>Verbinde mit zs_cryptoaddon...</small>
                </div>
            `;
        }
        
        // Sicherheits-Validierung f√ºr Transaktionen
        function validateCryptoTransaction(type, currency, amount) {
            if (!currency || !amount) {
                return { valid: false, error: 'Fehlende Parameter' };
            }
            
            const numAmount = parseFloat(amount);
            if (isNaN(numAmount) || numAmount <= 0) {
                return { valid: false, error: 'Ung√ºltiger Betrag' };
            }
            
            // Validierung gegen verf√ºgbare W√§hrungen
            const validCurrencies = ['BTC', 'ETH', 'ADA', 'XRP', 'DOT'];
            if (!validCurrencies.includes(currency)) {
                return { valid: false, error: 'Ung√ºltige W√§hrung' };
            }
            
            return { valid: true };
        }
        
        console.log('üöÄ Produktionsreife Crypto-UI vollst√§ndig geladen!');
        
        // ========================================
        // CRYPTO SYNCHRONISATION & HEARTBEAT
        // ========================================
        
        // Crypto-Heartbeat f√ºr kontinuierliche Synchronisation
        let cryptoHeartbeatInterval = null;
        let cryptoStatus = {
            available: false,
            resource: 'unknown',
            message: 'Initialisiere...',
            lastUpdate: null
        };
        
        // Starte Crypto-Heartbeat
        function startCryptoHeartbeat() {
            if (cryptoHeartbeatInterval) {
                clearInterval(cryptoHeartbeatInterval);
            }
            
            console.log('üîÑ Starte Crypto-Heartbeat...');
            
            // Sofort Status pr√ºfen
            checkCryptoStatus();
            
            // Alle 60 Sekunden Status pr√ºfen (reduziert von 30s)
            cryptoHeartbeatInterval = setInterval(() => {
                checkCryptoStatus();
            }, 60000);
            
            // Alle 15 Sekunden Preise aktualisieren
            const priceUpdateInterval = setInterval(() => {
                if (window.invokeNative) {
                    window.invokeNative('getCryptoData', {});
                }
            }, 15000);
            
            console.log('‚úÖ Crypto-Heartbeat gestartet (60s Status, 15s Preise)');
        }
        
        // Stoppe Crypto-Heartbeat
        function stopCryptoHeartbeat() {
            if (cryptoHeartbeatInterval) {
                clearInterval(cryptoHeartbeatInterval);
                cryptoHeartbeatInterval = null;
                console.log('‚èπÔ∏è Crypto-Heartbeat gestoppt');
            }
        }
        
        // Pr√ºfe Crypto-Status
        function checkCryptoStatus() {
            if (!window.invokeNative) {
                console.log('‚ùå NUI nicht verf√ºgbar f√ºr Crypto-Status-Check');
                return;
            }
            
            console.log('üîç Pr√ºfe Crypto-Status...');
            
            // Status √ºber NUI abfragen
            window.invokeNative('getCryptoData', {});
            
            // UI aktualisieren
            updateCryptoStatusUI();
        }
        
        // Aktualisiere Crypto-Status-UI (optimiert f√ºr Performance)
        function updateCryptoStatusUI() {
            // Nur aktualisieren wenn sich der Status wirklich ge√§ndert hat
            const currentStatus = cryptoStatus.available && cryptoStatus.resource === 'started';
            if (window.lastCryptoStatus === currentStatus) {
                return; // Keine √Ñnderung, √ºberspringe Update
            }
            window.lastCryptoStatus = currentStatus;
            
            // Batch DOM-Updates f√ºr bessere Performance
            requestAnimationFrame(() => {
                const statusIndicator = document.querySelector('.crypto-status-indicator');
                if (statusIndicator) {
                    statusIndicator.className = `crypto-status-indicator ${currentStatus ? 'online' : 'offline'}`;
                    statusIndicator.innerHTML = `
                        <i class="fas fa-circle"></i>
                        <span>${currentStatus ? 'Online' : 'Offline'}</span>
                        <small>${cryptoStatus.message}</small>
                    `;
                }
                
                // Aktualisiere Crypto-Tab-Status
                const cryptoTab = document.getElementById('crypto-tab-btn');
                if (cryptoTab) {
                    if (currentStatus) {
                        cryptoTab.classList.remove('error');
                        cryptoTab.classList.add('active');
                    } else {
                        cryptoTab.classList.remove('active');
                        cryptoTab.classList.add('error');
                    }
                }
            });
        }
        
        // Event-Listener f√ºr Crypto-Status-Updates (Performance-optimiert)
        window.addEventListener('message', function(event) {
            if (event.data.action === 'cryptoStatusUpdate') {
                // Throttle Updates f√ºr bessere Performance
                if (window.lastCryptoUpdate && Date.now() - window.lastCryptoUpdate < 1000) {
                    return; // Maximal 1 Update pro Sekunde
                }
                window.lastCryptoUpdate = Date.now();
                
                console.log('üì° Crypto-Status-Update empfangen:', event.data.status);
                
                cryptoStatus = {
                    ...event.data.status,
                    lastUpdate: new Date().toISOString()
                };
                
                // Verz√∂gertes UI-Update f√ºr bessere Performance
                setTimeout(() => {
                    updateCryptoStatusUI();
                }, 50);
                
                // Benachrichtigung anzeigen bei Status-√Ñnderung
                if (event.data.status.available !== window.cryptoAddonAvailable) {
                    const message = event.data.status.available ? 
                        'Crypto-System ist wieder verf√ºgbar' : 
                        'Crypto-System ist nicht verf√ºgbar';
                    
                    showNotification(message, event.data.status.available ? 'success' : 'error');
                    
                    // Globale Variable aktualisieren
                    window.cryptoAddonAvailable = event.data.status.available;
                }
            }
            
            // Neue Event-Handler f√ºr die Crypto-Integration
            else if (event.data.action === 'receiveAllCryptoData') {
                console.log('üìä Alle Crypto-Daten empfangen:', event.data.data);
                if (event.data.data && event.data.data.success) {
                    window.cryptoData = event.data.data;
                    updateCryptoUI();
                }
            }
            
            else if (event.data.action === 'updateCryptoWallet') {
                console.log('üíº Crypto-Wallet aktualisiert:', event.data.wallet);
                if (event.data.wallet) {
                    updatePortfolioSummary(event.data.wallet);
                }
            }
            
            else if (event.data.action === 'cryptoTransactionResult') {
                console.log('üí± Crypto-Transaktionsergebnis:', event.data.result);
                if (event.data.result) {
                    showTransactionResult(event.data.result);
                    // Aktualisiere UI nach Transaktion
                    setTimeout(() => {
                        window.invokeNative('refreshCryptoData', {});
                    }, 1000);
                }
            }
            
            else if (event.data.action === 'receiveCryptoPrices') {
                console.log('üí∞ Crypto-Preise aktualisiert:', event.data.prices);
                if (event.data.prices) {
                    updateCryptoPrices(event.data.prices);
                }
            }
            
            else if (event.data.action === 'receiveCryptoContests') {
                console.log('üèÜ Crypto-Wettbewerbe aktualisiert:', event.data.contests);
                if (event.data.contests) {
                    updateContestsUI(event.data.contests);
                }
            }
            
            else if (event.data.action === 'contestJoinResult') {
                console.log('üéØ Wettbewerb-Beitrittsergebnis:', event.data.result);
                if (event.data.result) {
                    showContestResult(event.data.result);
                }
            }
        });
        
        // ========================================
        // CRYPTO UI UPDATE FUNCTIONS
        // ========================================
        
        // Aktualisiere Crypto-UI mit neuen Daten
        function updateCryptoUI() {
            if (!window.cryptoData) return;
            
            // Aktualisiere Markt√ºbersicht
            if (window.cryptoData.prices && window.cryptoData.currencies) {
                displayRealCryptoData(window.cryptoData);
            }
            
            // Aktualisiere Portfolio
            if (window.cryptoData.wallet) {
                updatePortfolioSummary(window.cryptoData.wallet);
            }
            
            // Aktualisiere Wettbewerbe
            if (window.cryptoData.contests) {
                updateContestsUI(window.cryptoData.contests);
            }
        }
        
        // Aktualisiere Portfolio-Zusammenfassung
        function updatePortfolioSummary(wallet) {
            const portfolioValue = document.getElementById('portfolio-value');
            const totalInvested = document.getElementById('total-invested');
            const totalProfit = document.getElementById('total-profit');
            
            if (portfolioValue && wallet.totalValue !== undefined) {
                animateValue(portfolioValue, 0, wallet.totalValue, 400, true);
            }
            
            if (totalInvested && wallet.totalInvested !== undefined) {
                animateValue(totalInvested, 0, wallet.totalInvested, 400, true);
            }
            
            if (totalProfit && wallet.totalValue !== undefined && wallet.totalInvested !== undefined) {
                const profit = wallet.totalValue - wallet.totalInvested;
                animateValue(totalProfit, 0, profit, 400, true);
                
                // Farbe basierend auf Gewinn/Verlust
                totalProfit.style.color = profit >= 0 ? '#4CAF50' : '#f44336';
            }
        }
        
        // Aktualisiere Crypto-Preise
        function updateCryptoPrices(prices) {
            if (!prices) return;
            
            // Aktualisiere Preise in der Markt√ºbersicht
            Object.entries(prices).forEach(([currency, price]) => {
                const priceElement = document.querySelector(`[data-currency="${currency}"] .crypto-price`);
                if (priceElement) {
                    const oldPrice = parseFloat(priceElement.textContent.replace(/[$,]/g, ''));
                    const newPrice = price;
                    
                    // Animation f√ºr Preis√§nderung
                    animateValue(priceElement, oldPrice, newPrice, 300, true);
                }
            });
        }
        
        // Aktualisiere Wettbewerbe-UI
        function updateContestsUI(contests) {
            const contestsContainer = document.getElementById('contests-container');
            if (!contestsContainer) return;
            
            if (contests.length === 0) {
                contestsContainer.innerHTML = '<p class="no-contests">Keine aktiven Wettbewerbe verf√ºgbar</p>';
                return;
            }
            
            contestsContainer.innerHTML = contests.map(contest => `
                <div class="contest-card" data-contest-id="${contest.id}">
                    <div class="contest-header">
                        <h4>${contest.type}</h4>
                        <span class="contest-status ${contest.active ? 'active' : 'ended'}">
                            ${contest.active ? 'Aktiv' : 'Beendet'}
                        </span>
                    </div>
                    <div class="contest-details">
                        <p><strong>Preispool:</strong> $${contest.prizePool.toLocaleString()}</p>
                        <p><strong>Teilnehmer:</strong> ${Object.keys(contest.participants).length}</p>
                        <p><strong>Endet:</strong> ${new Date(contest.endTime * 1000).toLocaleDateString('de-DE')}</p>
                    </div>
                    ${contest.active ? `
                        <button class="btn btn-primary join-contest-btn" onclick="joinContest('${contest.id}')">
                            Beitreten
                        </button>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // Zeige Transaktionsergebnis
        function showTransactionResult(result) {
            const message = result.success ? 
                `‚úÖ ${result.message}` : 
                `‚ùå ${result.message}`;
            
            showNotification(message, result.success ? 'success' : 'error');
        }
        
        // Zeige Wettbewerbsergebnis
        function showContestResult(result) {
            const message = result.success ? 
                `‚úÖ ${result.message}` : 
                `‚ùå ${result.message}`;
            
            showNotification(message, result.success ? 'success' : 'error');
        }
        
        // ========================================
        // CRYPTO INTERACTION FUNCTIONS
        // ========================================
        
        // Wettbewerb beitreten
        function joinContest(contestId) {
            if (!window.invokeNative) return;
            
            window.invokeNative('joinContest', { contestId: contestId });
        }
        
        // Wettbewerbe abrufen
        function requestContests() {
            if (!window.invokeNative) return;
            
            window.invokeNative('requestContests', {});
        }
        
        // Crypto-Daten aktualisieren
        function refreshCryptoData() {
            if (!window.invokeNative) return;
            
            window.invokeNative('refreshCryptoData', {});
        }
        
        // Crypto-Preise abrufen
        function requestCryptoPrices() {
            if (!window.invokeNative) return;
            
            window.invokeNative('requestCryptoPrices', {});
        }
        
        // Crypto-Wallet abrufen
        function requestCryptoWallet() {
            if (!window.invokeNative) return;
            
            window.invokeNative('requestCryptoWallet', {});
        }
        
        // ========================================
        // CONTEST CREATION FUNCTIONS
        // ========================================
        
        // Zeige Contest-Erstellungs-Modal
        function showCreateContestModal() {
            const modal = document.getElementById('createContestModal');
            if (modal) {
                modal.style.display = 'block';
                
                // Event-Listener f√ºr Contest-Type-√Ñnderung
                const contestTypeSelect = document.getElementById('contestType');
                const customTypeGroup = document.getElementById('customTypeGroup');
                
                contestTypeSelect.addEventListener('change', function() {
                    if (this.value === 'Custom') {
                        customTypeGroup.style.display = 'block';
                    } else {
                        customTypeGroup.style.display = 'none';
                    }
                });
            }
        }
        
        // Schlie√üe Contest-Erstellungs-Modal
        function closeCreateContestModal() {
            const modal = document.getElementById('createContestModal');
            if (modal) {
                modal.style.display = 'none';
                
                // Reset form
                const form = document.getElementById('createContestForm');
                if (form) {
                    form.reset();
                    document.getElementById('customTypeGroup').style.display = 'none';
                }
            }
        }
        
        // Erstelle neuen Wettbewerb
        function createContest() {
            const contestTypeSelect = document.getElementById('contestType');
            const customTypeInput = document.getElementById('customType');
            const durationInput = document.getElementById('contestDuration');
            const prizePoolInput = document.getElementById('contestPrizePool');
            
            if (!contestTypeSelect || !durationInput || !prizePoolInput) {
                showNotification('Fehler beim Lesen der Formulardaten', 'error');
                return;
            }
            
            // Contest-Typ bestimmen
            let contestType = contestTypeSelect.value;
            if (contestType === 'Custom') {
                contestType = customTypeInput.value;
                if (!contestType || contestType.trim() === '') {
                    showNotification('Bitte gib einen Namen f√ºr den benutzerdefinierten Wettbewerb ein', 'error');
                    return;
                }
            }
            
            const duration = parseInt(durationInput.value);
            const prizePool = parseInt(prizePoolInput.value);
            
            // Validierung
            if (duration < 30 || duration > 720) {
                showNotification('Dauer muss zwischen 30 und 720 Minuten liegen', 'error');
                return;
            }
            
            if (prizePool < 1000 || prizePool > 100000) {
                showNotification('Preispool muss zwischen $1,000 und $100,000 liegen', 'error');
                return;
            }
            
            // Sende Contest-Erstellung an Server
            if (window.invokeNative) {
                window.invokeNative('createContest', {
                    type: contestType,
                    duration: duration * 60, // Konvertiere zu Sekunden
                    prizePool: prizePool
                });
                
                showNotification(`Wettbewerb "${contestType}" wird erstellt...`, 'info');
                closeCreateContestModal();
                
                // Aktualisiere Wettbewerbe nach kurzer Verz√∂gerung
                setTimeout(() => {
                    requestContests();
                }, 2000);
            } else {
                showNotification('Fehler: NUI nicht verf√ºgbar', 'error');
            }
        }
        
        // Aktualisiere Wettbewerbe (f√ºr Admin-Button)
        function refreshContests() {
            requestContests();
            showNotification('Wettbewerbe werden aktualisiert...', 'info');
        }
        
        // Pr√ºfe Admin-Status und zeige/verstecke Admin-Controls
        function checkAdminStatus() {
            // Hier kannst du die Admin-Pr√ºfung implementieren
            // F√ºr Demo-Zwecke zeige ich die Admin-Controls immer an
            // In der Realit√§t sollte dies √ºber den Server validiert werden
            
            if (window.playerData && window.playerData.isAdmin) {
                const adminControls = document.getElementById('contest-admin-controls');
                if (adminControls) {
                    adminControls.style.display = 'flex';
                }
            }
        }
        
        // Modal-Click-Outside-Handler
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('createContestModal');
            if (event.target === modal) {
                closeCreateContestModal();
            }
        });
        
        // ========================================
        // AUTOMATISCHE INITIALISIERUNG
        // ========================================
        
        // Starte Crypto-Synchronisation wenn Banking ge√∂ffnet wird
        document.addEventListener('DOMContentLoaded', function() {
            // Warte auf Banking-Initialisierung
            setTimeout(() => {
                if (window.cryptoAddonAvailable) {
                    console.log('üöÄ Starte automatische Crypto-Synchronisation...');
                    startCryptoHeartbeat();
                }
            }, 2000);
        });
        
    </script>
    <script src="app.js"></script>
</body>
</html>



